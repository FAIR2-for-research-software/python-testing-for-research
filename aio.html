<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en" data-bs-theme="auto">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<title>Software Testing for Research - Python: All in One View</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="assets/themetoggle.js"></script><link rel="stylesheet" type="text/css" href="assets/styles.css">
<script src="assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="manifest" href="site.webmanifest">
<link rel="mask-icon" href="safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="white">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="black">
</head>
<body>
    <header id="top" class="navbar navbar-expand-md top-nav incubator"><svg xmlns="http://www.w3.org/2000/svg" class="d-none"><symbol id="check2" viewbox="0 0 16 16"><path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"></path></symbol><symbol id="circle-half" viewbox="0 0 16 16"><path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"></path></symbol><symbol id="moon-stars-fill" viewbox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"></path></symbol><symbol id="sun-fill" viewbox="0 0 16 16"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></symbol></svg><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-8">
      <div class="large-logo">
        <img id="incubator-logo" alt="Carpentries Incubator" src="assets/images/incubator-logo.svg"><span class="badge text-bg-danger">
          <abbr title="This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.">
            <a href="https://cdh.carpentries.org/the-lesson-life-cycle.html#early-development-pre-alpha-through-alpha" class="external-link alert-link">
              <i aria-hidden="true" class="icon" data-feather="alert-octagon" style="border-radius: 5px"></i>
              Pre-Alpha
            </a>
            <span class="visually-hidden">This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.</span>
          </abbr>
        </span>

      </div>
    </div>
    <div class="selector-container">
      <div id="theme-selector">
        <li class="nav-item dropdown" id="theme-button-list">
          <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
            <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text">
<li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                Light
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                Dark
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                Auto
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
          </ul>
</li>
      </div>

      <div class="dropdown" id="instructor-dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Learner View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
<li><button class="dropdown-item" type="button" onclick="window.location.href='instructor/aio.html';">Instructor View</button></li>
        </ul>
</div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl bottom-nav incubator" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Carpentries Incubator" src="assets/images/incubator-logo-sm.svg">
</div>
    <div class="lesson-title-md">
      Software Testing for Research - Python
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="Search the All In One page" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
<li class="nav-item">
          <span class="lesson-title">
            Software Testing for Research - Python
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="reference.html#glossary">Glossary</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="profiles.html">Learner Profiles</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
<li><a class="dropdown-item" href="reference.html">Reference</a></li>
          </ul>
</li>
      </ul>
</div>
    <!--
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
      <input class="form-control me-2 searchbox" type="search" placeholder="" aria-label="">
        <button class="btn btn-outline-success tablet-search-button"  type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="Search the All In One page"></i>
        </button>
      </fieldset>
    </form>
    -->
    <a id="search-button" class="btn btn-primary" href="aio.html" role="button" aria-label="Search the All In One page">Search the All In One page</a>
  </div>
<!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Software Testing for Research - Python
</div>

<aside class="col-md-12 lesson-progress"><div style="width: %" class="percentage">
    %
  </div>
  <div class="progress incubator">
    <div class="progress-bar incubator" role="progressbar" style="width: %" aria-valuenow="" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row" id="theme-row-mobile">
            <div class="col" id="theme-selector">
              <li class="nav-item dropdown" id="theme-button-list">
                <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
                  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><span class="d-lg-none ms-1" id="bd-theme-text">Toggle Theme</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="bd-theme-text">
<li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                      Light
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                      Dark
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                      <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                      Auto
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                </ul>
</li>
            </div>
          </div>
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Learner View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="instructor/aio.html">Instructor View</a>
                      </div>
                    </div>
                  </div>
<!--/div.accordion-item-->
                </div>
<!--/div.accordion-flush-->
              </div>
<!--div.sidenav-view-selector -->
            </div>
<!--/div.col -->

            <hr>
</div>
<!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Setup</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="00-introduction.html">1. Introduction</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="01-why-test-my-code.html">2. Why Test My Code?</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="02-simple-tests.html">3. Simple Tests</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="03-interacting-with-tests.html">4. Interacting with Tests</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="04-unit-tests-best-practices.html">5. Unit tests &amp; Testing Practices</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush7">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading7">
        <a href="05-testing-exceptions.html">6. Testing for Exceptions</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush8">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading8">
        <a href="06-testing-data-structures.html">7. Testing Data Structures</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush9">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading9">
        <a href="07-fixtures.html">8. Fixtures</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush10">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading10">
        <a href="08-parametrization.html">9. Parametrization</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush11">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading11">
        <a href="09-testing-output-files.html">10. Regression Testing and Plots</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush12">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading12">
        <a href="10-CI.html">11. Continuous Integration with GitHub Actions</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width">
<div class="accordion accordion-flush resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul>
<li>
                        <a href="key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="reference.html#glossary">Glossary</a>
                      </li>
                      <li>
                        <a href="profiles.html">Learner Profiles</a>
                      </li>
                      <li><a href="reference.html">Reference</a></li>
                    </ul>
</div>
                </div>
              </div>
            </div>
            <hr class="half-width resources">
<a href="aio.html">See all in one page</a>


            <hr class="d-none d-sm-block d-md-none">
<div class="d-grid gap-1">

            </div>
          </div>
<!-- /div.accordion -->
        </div>
<!-- /div.sidebar-inner -->
      </nav>
</div>
<!-- /div.sidebar -->
  </div>
<!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-extra.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <main id="main-content" class="main-content"><div class="container lesson-content">
        
        
<section id="aio-00-introduction"><p>Content from <a href="00-introduction.html">Introduction</a></p>
<hr>
<p>Last updated on 2024-07-09 |

        <a href="https://github.com/SylviaWhittle/python-testing-for-research/edit/main/episodes/00-introduction.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What are the goals of this course?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>To understand the learning outcomees of this course</li>
<li>To understand the structure of the practicals</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="welcome-to-testing-and-continuous-integration-with-python">Welcome to Testing and Continuous Integration with Python<a class="anchor" aria-label="anchor" href="#welcome-to-testing-and-continuous-integration-with-python"></a>
<a class="anchor" aria-label="anchor" href="#welcome-to-testing-and-continuous-integration-with-python"></a>
</h2>
<hr class="half-width">
<p>This course aims to equip researchers with the skills to write
effective tests and ensure the quality and reliability of their research
software. No prior testing experience is required! We’ll guide you
through the fundamentals of software testing using Python’s Pytest
framework, a powerful and beginner-friendly tool. You’ll also learn how
to integrate automated testing into your development workflow using
continuous integration (CI). CI streamlines your process by
automatically running tests with every code change, catching bugs early
and saving you time. By the end of the course, you’ll be able to write
clear tests, leverage CI for efficient development, and ultimately
strengthen the foundation of your scientific findings.</p>
<p>This course has a single continuous project that you will work on
throughout the lessons and each lesson builds on the last through
practicals that will help you apply the concepts you learn. However if
you get stuck or fall behind during the course, don’t worry! All the
stages of the project for each lesson are available in the
<code>files</code> directory in this course’s materials that you can
copy across if needed. For example if you are on lesson 3 and haven’t
completed the practicals for lesson 2, you can copy the corresponding
folder from the <code>files</code> directory.</p>
<p>By the end of this course, you should:</p>
<ul>
<li>Understand how testing can be used to improve code &amp; research
reliability</li>
<li>Be comfortable with writing basic tests &amp; running them</li>
<li>Be able to construct a simple Python project that incorporates
tests</li>
<li>Be familiar with testing best practices such as unit testing &amp;
the AAA pattern</li>
<li>Be aware of more advanced testing features such as fixtures &amp;
parametrization</li>
<li>Understand what Continuous Integration is and why it is useful</li>
<li>Be able to add testing to a GitHub repository with simple Continuous
Integration</li>
</ul></section><section><h2 class="section-heading" id="code-of-conduct">Code of Conduct<a class="anchor" aria-label="anchor" href="#code-of-conduct"></a>
<a class="anchor" aria-label="anchor" href="#code-of-conduct"></a>
</h2>
<hr class="half-width">
<p>This course is covered by the <a href="https://docs.carpentries.org/topic_folders/policies/code-of-conduct.html" class="external-link">Carpentries
Code of Conduct</a>.</p>
<p>As mentioned in the Carpentries Code of Conduct, we encourage you
to:</p>
<ul>
<li>Use welcoming and inclusive language</li>
<li>Be respectful of different viewpoints and experiences</li>
<li>Gracefully accept constructive criticism</li>
<li>Focus on what is best for the community</li>
<li>Show courtesy and respect towards other community members</li>
</ul>
<p>Instances of abusive, harassing, or otherwise unacceptable behavior
may be reported by following our <a href="https://docs.carpentries.org/topic_folders/policies/incident-reporting.html" class="external-link">reporting
guidelines</a>.</p>
</section><section><h2 class="section-heading" id="challenges">Challenges<a class="anchor" aria-label="anchor" href="#challenges"></a>
<a class="anchor" aria-label="anchor" href="#challenges"></a>
</h2>
<hr class="half-width">
<p>This course uses blocks like the one below to indicate an exercise
for you to attempt. The solution is hidden by default and can be clicked
on to reveal it.</p>
<div id="challenge-1-talk-to-your-neighbour" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-1-talk-to-your-neighbour" class="callout-inner">
<h3 class="callout-title">Challenge 1: Talk to your neighbour<a class="anchor" aria-label="anchor" href="#challenge-1-talk-to-your-neighbour"></a>
</h3>
<div class="callout-content">
<ul>
<li>Introduce yourself to your neighbour</li>
<li>Have either of you experienced a time when testing would have been
useful?</li>
<li>Have either of you written scripts to check that your code is
working as expected?</li>
</ul>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<ul>
<li>Perhaps during a project your code kept breaking and taking up a lot
of your time?</li>
<li>Perhaps you have written a script to check that your data is being
processed correctly?</li>
</ul>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>This course will teach you how to write effective tests and ensure
the quality and reliability of your research software</li>
<li>No prior testing experience is required</li>
<li>You can catch up on practicals by copying the corresponding folder
from the <code>files</code> directory of this course’s materials</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-01-why-test-my-code"><p>Content from <a href="01-why-test-my-code.html">Why Test My Code?</a></p>
<hr>
<p>Last updated on 2024-07-09 |

        <a href="https://github.com/SylviaWhittle/python-testing-for-research/edit/main/episodes/01-why-test-my-code.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>Why should I test my code?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Understand how testing can help to ensure that code is working as
expected</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="what-is-software-testing">What is software testing?<a class="anchor" aria-label="anchor" href="#what-is-software-testing"></a>
<a class="anchor" aria-label="anchor" href="#what-is-software-testing"></a>
</h2>
<hr class="half-width">
<p>Software testing is the process of checking that code is working as
expected. You may have data processing functions or automations that you
use in your work - how do you know that they are doing what you expect
them to do?</p>
<p>Software testing is most commonly done by writing code (tests) that
check that your code work as expected.</p>
<p>This might seem like a lot of effort, so let’s go over some of the
reasons you might want to add tests to your project.</p>
</section><section><h2 class="section-heading" id="catching-bugs">Catching bugs<a class="anchor" aria-label="anchor" href="#catching-bugs"></a>
<a class="anchor" aria-label="anchor" href="#catching-bugs"></a>
</h2>
<hr class="half-width">
<p>Whether you are writing the occasional script or developing a large
software, mistakes are inevitable. Sometimes you don’t even know when a
mistake creeps into the code, and it gets published.</p>
<p>Consider the following function:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="kw">def</span> add(a, b):</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>    <span class="cf">return</span> a <span class="op">-</span> b</span></code></pre>
</div>
<p>When writing this function, I made a mistake. I accidentally wrote
<code>a - b</code> instead of <code>a + b</code>. This is a simple
mistake, but it could have serious consequences in a project.</p>
<p>When writing the code, I could have tested this function by manually
trying it with different input and checking the output, but:</p>
<ul>
<li>This takes time.</li>
<li>I might forget to test it again when we make changes to the code
later on.</li>
<li>Nobody else in my team knows if I tested it, or how I tested it, and
therefore whether they can trust it.</li>
</ul>
<p>This is where automated testing comes in.</p>
</section><section><h2 class="section-heading" id="automated-testing">Automated testing<a class="anchor" aria-label="anchor" href="#automated-testing"></a>
<a class="anchor" aria-label="anchor" href="#automated-testing"></a>
</h2>
<hr class="half-width">
<p>Automated testing is where we write code that checks that our code
works as expected. Every time we make a change, we can run our tests to
automatically make sure that our code still works as expected.</p>
<p>If we were writing a test from scratch for the <code>add</code>
function, think for a moment on how we would do it. We would need to
write a function that runs the <code>add</code> function on a set of
inputs, checking each case to ensure it does what we expect. Let’s write
a test for the <code>add</code> function and call it
<code>test_add</code>:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="kw">def</span> test_add():</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>   <span class="co"># Check that it adds two positive integers</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>   <span class="cf">if</span> add(<span class="dv">1</span>, <span class="dv">2</span>) <span class="op">!=</span> <span class="dv">3</span>:</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>      <span class="bu">print</span>(<span class="st">"Test failed!"</span>)</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>   <span class="co"># Check that it adds zero</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>   <span class="cf">if</span> add(<span class="dv">5</span>, <span class="dv">0</span>) <span class="op">!=</span> <span class="dv">5</span>:</span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>      <span class="bu">print</span>(<span class="st">"Test failed!"</span>)</span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a>   <span class="co"># Check that it adds two negative integers</span></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a>   <span class="cf">if</span> add(<span class="op">-</span><span class="dv">1</span>, <span class="op">-</span><span class="dv">2</span>) <span class="op">!=</span> <span class="op">-</span><span class="dv">3</span>:</span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a>      <span class="bu">print</span>(<span class="st">"Test failed!"</span>)</span></code></pre>
</div>
<p>Here we check that the function works for a set of test cases. We
ensure that it works for positive numbers, negative numbers, and
zero.</p>
<div id="challenge-1-what-could-go-wrong" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-1-what-could-go-wrong" class="callout-inner">
<h3 class="callout-title">Challenge 1: What could go wrong?<a class="anchor" aria-label="anchor" href="#challenge-1-what-could-go-wrong"></a>
</h3>
<div class="callout-content">
<p>When writing functions, sometimes we don’t anticipate all the ways
that they could go wrong.</p>
<p>Take a moment to think about what is wrong, or might go wrong with
these functions:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="kw">def</span> greet_user(name):</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>   <span class="cf">return</span> <span class="st">"Hello"</span> <span class="op">+</span> name <span class="op">+</span> <span class="st">"!"</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="kw">def</span> gradient(x1, y1, x2, y2):</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>    <span class="cf">return</span> (y2 <span class="op">-</span> y1) <span class="op">/</span> (x2 <span class="op">-</span> x1)</span></code></pre>
</div>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">
  Answer
  </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<p>The first function will incorrectly greet the user, as it is missing
a space after “Hello”. It would print <code>HelloAlice!</code> instead
of <code>Hello Alice!</code>.</p>
<p>If we wrote a test for this function, we would have noticed that it
was not working as expected:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="kw">def</span> test_greet_user():</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>   <span class="cf">if</span> greet_user(<span class="st">"Alice"</span>) <span class="op">!=</span> <span class="st">"Hello Alice!"</span>:</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>      <span class="bu">print</span>(<span class="st">"Test failed!"</span>)</span></code></pre>
</div>
<p>The second function will crash if <code>x2 - x1</code> is zero.</p>
<p>If we wrote a test for this function, it may have helped us to catch
this unexpected behaviour:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="kw">def</span> test_gradient():</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>   <span class="cf">if</span> gradient(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>) <span class="op">!=</span> <span class="dv">1</span>:</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>      <span class="bu">print</span>(<span class="st">"Test failed!"</span>)</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>   <span class="cf">if</span> gradient(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>) <span class="op">!=</span> <span class="dv">2</span>:</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>      <span class="bu">print</span>(<span class="st">"Test failed!"</span>)</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>   <span class="cf">if</span> gradient(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>) <span class="op">!=</span> <span class="st">"Undefined"</span>:</span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>      <span class="bu">print</span>(<span class="st">"Test failed!"</span>)</span></code></pre>
</div>
<p>And we could have ammened the function:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="kw">def</span> gradient(x1, y1, x2, y2):</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>   <span class="cf">if</span> x2 <span class="op">-</span> x1 <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>      <span class="cf">return</span> <span class="st">"Undefined"</span></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>   <span class="cf">return</span> (y2 <span class="op">-</span> y1) <span class="op">/</span> (x2 <span class="op">-</span> x1)</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="finding-the-root-cause-of-a-bug">Finding the root cause of a bug<a class="anchor" aria-label="anchor" href="#finding-the-root-cause-of-a-bug"></a>
<a class="anchor" aria-label="anchor" href="#finding-the-root-cause-of-a-bug"></a>
</h2>
<hr class="half-width">
<p>When a test fails, it can help us to find the root cause of a bug.
For example, consider the following function:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="kw">def</span> multiply(a, b):</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>      <span class="cf">return</span> a <span class="op">*</span> a</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="kw">def</span> divide(a, b):</span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>      <span class="cf">return</span> a <span class="op">/</span> b</span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a><span class="kw">def</span> triangle_area(base, height):</span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a>      <span class="cf">return</span> divide(multiply(base, height), <span class="dv">2</span>)</span></code></pre>
</div>
<p>There is a bug in this code too, but since we have several functions
calling each other, it is not immediately obvious where the bug is.
Also, the bug is not likely to cause a crash, so we won’t get a helpful
error message telling us what went wrong. If a user happened to notice
that there was an error, then we would have to check
<code>triangle_area</code> to see if the formula we used is right, then
<code>multiply</code>, and <code>divide</code> to see if they were
working as expected too!</p>
<p>However, if we had written tests for these functions, then we would
have seen that both the <code>triangle_area</code> and
<code>multiply</code> functions were not working as expected, allowing
us to quickly see that the bug was in the <code>multiply</code> function
without having to check the other functions.</p>
</section><section><h2 class="section-heading" id="increased-confidence-in-code">Increased confidence in code<a class="anchor" aria-label="anchor" href="#increased-confidence-in-code"></a>
<a class="anchor" aria-label="anchor" href="#increased-confidence-in-code"></a>
</h2>
<hr class="half-width">
<p>When you have tests for your code, you can be more confident that it
works as expected. This is especially important when you are working in
a team or producing software for users, as it allows everyone to trust
the code. If you have a test that checks that a function works as
expected, then you can be confident that the function will work as
expected, even if you didn’t write it yourself.</p>
</section><section><h2 class="section-heading" id="forcing-a-more-structured-approach-to-coding">Forcing a more structured approach to coding<a class="anchor" aria-label="anchor" href="#forcing-a-more-structured-approach-to-coding"></a>
<a class="anchor" aria-label="anchor" href="#forcing-a-more-structured-approach-to-coding"></a>
</h2>
<hr class="half-width">
<p>When you write tests for your code, you are forced to think more
carefully about how your code behaves and how you will verify that it
works as expected. This can help you to write more structured code, as
you will need to think about how to test it as well as how it could
fail.</p>
<div id="challenge-2-what-could-go-wrong" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-2-what-could-go-wrong" class="callout-inner">
<h3 class="callout-title">Challenge 2: What could go wrong?<a class="anchor" aria-label="anchor" href="#challenge-2-what-could-go-wrong"></a>
</h3>
<div class="callout-content">
<p>Consider a function that controls a driverless car.</p>
<ul>
<li>What checks might we add to make sure it is not dangerous to
use?</li>
</ul>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="kw">def</span> drive_car(speed, direction):</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>   ... <span class="co"># complex car driving code</span></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>    <span class="cf">return</span> speed, direction, brake_status</span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a>   </span></code></pre>
</div>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">
  Answer
  </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<ul>
<li><p>We might want to check that the speed is within a safe
range.</p></li>
<li><p>We might want to check that the direction is a valid direction.
ie not towards a tree, and if so, the car should be applying the
brakes.</p></li>
</ul>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Automated testing helps to catch hard to spot errors in code &amp;
find the root cause of complex issues.</li>
<li>Tests reduce the time spent manually verifying (and re-verifying!)
that code works.</li>
<li>Tests help to ensure that code works as expected when changes are
made.</li>
<li>Tests are especially useful when working in a team, as they help to
ensure that everyone can trust the code.</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-02-simple-tests"><p>Content from <a href="02-simple-tests.html">Simple Tests</a></p>
<hr>
<p>Last updated on 2024-07-09 |

        <a href="https://github.com/SylviaWhittle/python-testing-for-research/edit/main/episodes/02-simple-tests.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How to write a simple test?</li>
<li>How to run the test?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Write a basic test.</li>
<li>Run the test.</li>
<li>Understand its output in the terminal.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="your-first-test">Your first test<a class="anchor" aria-label="anchor" href="#your-first-test"></a>
<a class="anchor" aria-label="anchor" href="#your-first-test"></a>
</h2>
<hr class="half-width">
<p>The most basic thing you will want to do in a test is check that an
output for a function is correct, by checking that it is equal to a
certain value.</p>
<p>Let’s take the <code>add</code> function example from the previous
chapter and the test we conceptualised for it and write it in code.</p>
<ul>
<li>Make a folder called <code>my_project</code> (or whatever you want
to call it for these lessons) and inside it, create a file called
‘calculator.py’, and another file called ‘test_calculator.py’.</li>
</ul>
<p>So your directory structure should look like this:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="ex">project_directory/</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="ex">│</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="ex">├──</span> calculator.py</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="ex">└──</span> test_calculator.py</span></code></pre>
</div>
<p><code>calculator.py</code> will contain our Python functions that we
want to test, and <code>test_calculator.py</code> will contain our tests
for those functions.</p>
<ul>
<li>In <code>calculator.py</code>, write the add function:</li>
</ul>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="kw">def</span> add(a, b):</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>  <span class="cf">return</span> a <span class="op">+</span> b</span></code></pre>
</div>
<ul>
<li>And in <code>test_calculator.py</code>, write the test for the add
function that we conceptualised in the previous lesson:</li>
</ul>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="co"># Import the add function so the test can use it</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="im">from</span> calculator <span class="im">import</span> add</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="kw">def</span> test_add():</span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>   <span class="co"># Check that it adds two positive integers</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>   <span class="cf">if</span> add(<span class="dv">1</span>, <span class="dv">2</span>) <span class="op">!=</span> <span class="dv">3</span>:</span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>      <span class="bu">print</span>(<span class="st">"Test failed!"</span>)</span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>      <span class="cf">raise</span> <span class="pp">AssertionError</span>(<span class="st">"Test failed!"</span>)</span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a>   <span class="co"># Check that it adds zero</span></span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a>   <span class="cf">if</span> add(<span class="dv">5</span>, <span class="dv">0</span>) <span class="op">!=</span> <span class="dv">5</span>:</span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a>      <span class="bu">print</span>(<span class="st">"Test failed!"</span>)</span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a>      <span class="cf">raise</span> <span class="pp">AssertionError</span>(<span class="st">"Test failed!"</span>)</span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a>   <span class="co"># Check that it adds two negative integers</span></span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a>   <span class="cf">if</span> add(<span class="op">-</span><span class="dv">1</span>, <span class="op">-</span><span class="dv">2</span>) <span class="op">!=</span> <span class="op">-</span><span class="dv">3</span>:</span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a>      <span class="bu">print</span>(<span class="st">"Test failed!"</span>)</span>
<span id="cb3-18"><a href="#cb3-18" tabindex="-1"></a>      <span class="cf">raise</span> <span class="pp">AssertionError</span>(<span class="st">"Test failed!"</span>)</span></code></pre>
</div>
<p>(Note that the <code>AssertionError</code> is a way to tell Python to
crash the test, so Pytest knows that the test has failed.)</p>
<p>This system of placing functions in a file and then tests for those
functions in another file, is a common pattern in software development.
It allows you to keep your code organised and separate your tests from
your actual code.</p>
<p>With Pytest, the expectation is to name your test functions with the
prefix <code>test_</code>.</p>
<p>Now, let’s run the test. We can do this by running the following
command in the terminal:</p>
<p>(make sure you’re in the <code>my_project</code> directory before
running this command)</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="ex">❯</span> pytest ./</span></code></pre>
</div>
<p>This command tells pytest to run all the tests in the current
directory.</p>
<p>When you run the test, you should see that the test runs
successfully, indicated by some <span style="color:green"><strong>green</strong></span>. text in the terminal.
We will go through the output and what it means in the next lesson, but
for now, know that <span style="color:green"><strong>green</strong></span> means that the test
passed, and <span style="color:red"><strong>red</strong></span> means
that the test failed.</p>
<p>Try changing the <code>add</code> function to return the wrong value,
and run the test again to see that the test now fails and the text turns
<span style="color:red"><strong>red</strong></span> - neat!</p>
</section><section><h2 class="section-heading" id="the-assert-keyword">The <code>assert</code> keyword<a class="anchor" aria-label="anchor" href="#the-assert-keyword"></a>
<a class="anchor" aria-label="anchor" href="#the-assert-keyword"></a>
</h2>
<hr class="half-width">
<p>Writing these <code>if</code> blocks for each test case is
cumbersome. Fortunately, Python has a keyword to do this for us - the
<code>assert</code> keyword.</p>
<p>The <code>assert</code> keyword checks if a statement is true and if
it is, the test continues, but if it isn’t, then the test will crash,
printing an error in the terminal. This enables us to write succinct
tests without lots of if-statements.</p>
<p>The <code>assert</code> keyword is used like this:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="cf">assert</span> add(<span class="dv">1</span>, <span class="dv">2</span>) <span class="op">==</span> <span class="dv">3</span></span></code></pre>
</div>
<p>which is equivalent to:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="cf">if</span> add(<span class="dv">1</span>, <span class="dv">2</span>) <span class="op">!=</span> <span class="dv">3</span>:</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>  <span class="co"># Crash the test</span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>  <span class="cf">raise</span> <span class="pp">AssertionError</span></span></code></pre>
</div>
<div id="challenge-1-use-the-assert-keyword-to-update-the-test-for-the-add-function" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-1-use-the-assert-keyword-to-update-the-test-for-the-add-function" class="callout-inner">
<h3 class="callout-title">Challenge 1: Use the assert keyword to update the test for the add function<a class="anchor" aria-label="anchor" href="#challenge-1-use-the-assert-keyword-to-update-the-test-for-the-add-function"></a>
</h3>
<div class="callout-content">
<p>Use the <code>assert</code> keyword to update the test for the
<code>add</code> function to make it more concise and readable.</p>
<p>Then re-run the test using <code>pytest ./</code> to check that it
still passes.</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="im">from</span> calculator <span class="im">import</span> add</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a><span class="kw">def</span> test_add():</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>  <span class="cf">assert</span> add(<span class="dv">1</span>, <span class="dv">2</span>) <span class="op">==</span> <span class="dv">3</span> <span class="co"># Check that it adds to positive integers</span></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>  <span class="cf">assert</span> add(<span class="dv">5</span>, <span class="dv">0</span>) <span class="op">==</span> <span class="dv">5</span> <span class="co"># Check that it adds zero</span></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>  <span class="cf">assert</span> add(<span class="op">-</span><span class="dv">1</span>, <span class="op">-</span><span class="dv">2</span>) <span class="op">==</span> <span class="op">-</span><span class="dv">3</span> <span class="co"># Check that it adds wro negative numbers</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<p>Now that we are using the <code>assert</code> keyword, pytest will
let us know if our test fails.</p>
<p>What’s more, is that if any of these assert statements fail, it will
flag to pytest that the test has failed, and pytest will let you
know.</p>
<p>Make the <code>add</code> function return the wrong value, and run
the test again to see that the test fails and the text turns <span style="color:red"><strong>red</strong></span> as we expect.</p>
<p>So if this was a real testing situation, we would know to investigate
the <code>add</code> function to see why it’s not behaving as
expected.</p>
<div id="challenge-2-write-a-test-for-a-multiply-function" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-2-write-a-test-for-a-multiply-function" class="callout-inner">
<h3 class="callout-title">Challenge 2: Write a test for a multiply function<a class="anchor" aria-label="anchor" href="#challenge-2-write-a-test-for-a-multiply-function"></a>
</h3>
<div class="callout-content">
<p>Try using what we have covered to write a test for a
<code>multiply</code> function that multiplies two numbers together.</p>
<ul>
<li>Place this multiply function in <code>calculator.py</code>:</li>
</ul>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="kw">def</span> multiply(a, b):</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>  <span class="cf">return</span> a <span class="op">*</span> b</span></code></pre>
</div>
<ul>
<li>Then write a test for this function in
<code>test_calculator.py</code>. Remember to import the
<code>multiply</code> function from <code>calculator.py</code> at the
top of the file like this:</li>
</ul>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="im">from</span> calculator <span class="im">import</span> multiply</span></code></pre>
</div>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Solution: </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<p>There are many different test cases that you could include, but it’s
important to check that different types of cases are covered. A test for
this function could look like this:</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="kw">def</span> test_multiply():</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>  <span class="co"># Check that positive numbers work</span></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>  <span class="cf">assert</span> multiply(<span class="dv">5</span>, <span class="dv">5</span>) <span class="op">==</span> <span class="dv">25</span></span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>  <span class="co"># Check that multiplying by 1 works</span></span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>  <span class="cf">assert</span> multiply(<span class="dv">1</span>, <span class="dv">5</span>) <span class="op">==</span> <span class="dv">5</span></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a>  <span class="co"># Check that multiplying by 0 works</span></span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a>  <span class="cf">assert</span> multiply(<span class="dv">0</span>, <span class="dv">3</span>) <span class="op">==</span> <span class="dv">0</span></span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a>  <span class="co"># Check that negative numbers work</span></span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a>  <span class="cf">assert</span> multiply(<span class="op">-</span><span class="dv">5</span>, <span class="dv">2</span>) <span class="op">==</span> <span class="op">-</span><span class="dv">10</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<p>Run the test using <code>pytest ./</code> to check that it passes. If
it doesn’t, don’t worry, that’s the point of testing - to find bugs in
code.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>The <code>assert</code> keyword is used to check if a statement is
true and is a shorthand for writing <code>if</code> statements in
tests.</li>
<li>Pytest is invoked by running the command <code>pytest ./</code> in
the terminal.</li>
<li>
<code>pytest</code> will run all the tests in the current directory,
found by looking for files that start with <code>test_</code>.</li>
<li>The output of a test is displayed in the terminal, with <span style="color:green"><strong>green</strong></span> text indicating a
successful test and <span style="color:red"><strong>red</strong></span>
text indicating a failed test.</li>
<li>It’s best practice to write tests in a separate file from the code
they are testing. Eg: <code>scripts.py</code> and
<code>test_scripts.py</code>.</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-03-interacting-with-tests"><p>Content from <a href="03-interacting-with-tests.html">Interacting with Tests</a></p>
<hr>
<p>Last updated on 2024-07-09 |

        <a href="https://github.com/SylviaWhittle/python-testing-for-research/edit/main/episodes/03-interacting-with-tests.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do I use pytest to run my tests?</li>
<li>What does the output of pytest look like and how do I interpret
it?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Understand how to run tests using pytest.</li>
<li>Understand how to interpret the output of pytest.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="running-pytest">Running pytest<a class="anchor" aria-label="anchor" href="#running-pytest"></a>
<a class="anchor" aria-label="anchor" href="#running-pytest"></a>
</h2>
<hr class="half-width">
<p>As we saw in the previous lesson, you can invoke pytest using the
<code>pytest</code> terminal command. This searches within the current
directory (and any sub-directories) for files that start or end with
‘test’. For example: <code>test_scripts.py</code>,
<code>scripts_test.py</code>. It then searches for tests in these files,
which are functions (or classes) with names start with ‘test’, such as
the <code>test_add</code> function we made in the previous lesson.</p>
<p>So far, we should have a file called <code>calculator.py</code> with
an <code>add</code> and <code>multiply</code> function, and a file
called <code>test_calculator.py</code> with <code>test_add</code> and
<code>test_multiply</code> functions. If you are missing either of
these, they are listed in the previous lesson.</p>
<p>To show off pytest’s ability to search multiple files for tests,
let’s create a directory (folder) inside the current project directory
called <code>advanced</code> where we will add some advanced calculator
functionality.</p>
<ul>
<li>Create a directory called <code>advanced</code> inside your project
directory.</li>
<li>Inside this directory, create a file called
<code>advanced_calculator.py</code> and a file called
<code>test_advanced_calculator.py</code>.</li>
</ul>
<p>Your project directory should now look like this:</p>
<pre><code>project_directory/
│
├── calculator.py
├── test_calculator.py
│
└── advanced/
    ├── advanced_calculator.py
    └── test_advanced_calculator.py</code></pre>
<ul>
<li>In the <code>advanced_calculator.py</code> file, add the following
code:</li>
</ul>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="kw">def</span> power(value, exponent):</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>    <span class="co">"""Raise a value to an exponent"""</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>    result <span class="op">=</span> value</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>    <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(exponent<span class="op">-</span><span class="dv">1</span>):</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>        result <span class="op">*=</span> value</span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>    <span class="cf">return</span> result</span></code></pre>
</div>
<ul>
<li>In the <code>test_advanced_calculator.py</code> file, add the
following test:</li>
</ul>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="im">from</span> advanced_calculator <span class="im">import</span> power</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="kw">def</span> test_power():</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>    <span class="co">"""Test for the power function"""</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>    <span class="cf">assert</span> power(<span class="dv">2</span>, <span class="dv">3</span>) <span class="op">==</span> <span class="dv">8</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>    <span class="cf">assert</span> power(<span class="dv">3</span>, <span class="dv">3</span>) <span class="op">==</span> <span class="dv">27</span></span></code></pre>
</div>
<ul>
<li>Now run <code>pytest</code> in the terminal. You should see that all
tests pass due to the <span style="color:green">green</span>
output.</li>
</ul>
<p>Let’s have a closer look at the output of pytest.</p>
</section><section><h2 class="section-heading" id="test-output">Test output<a class="anchor" aria-label="anchor" href="#test-output"></a>
<a class="anchor" aria-label="anchor" href="#test-output"></a>
</h2>
<hr class="half-width">
<p>When running pytest, there are usually two possible outcomes:</p>
<div class="section level3">
<h3 id="case-1-all-tests-pass">Case 1: All tests pass<a class="anchor" aria-label="anchor" href="#case-1-all-tests-pass"></a>
</h3>
<p>Let’s break down the successful output in more detail.</p>
<pre><code>=== test session starts ===</code></pre>
<ul>
<li>The first line tells us that pytest has started running tests.</li>
</ul>
<pre><code>platform darwin -- Python 3.11.0, pytest-8.1.1, pluggy-1.4.0</code></pre>
<ul>
<li>The next line just tells us the versions of several packages.</li>
</ul>
<pre><code>rootdir: /Users/sylvi/Documents/GitKraken/python-testing-for-research/episodes/files/03-interacting-with-tests</code></pre>
<ul>
<li>The next line tells us where the tests are being searched for. In
this case, it is your project directory. So any file that starts or ends
with <code>test</code> anywhere in this directory will be opened and
searched for test functions.</li>
</ul>
<pre><code>plugins: regtest-2.1.1</code></pre>
<ul>
<li>This tells us what plugins are being used. In my case, I have a
plugin called <code>regtest</code> that is being used, but you may not.
This is fine and you can ignore it.</li>
</ul>
<pre><code>collected 3 items</code></pre>
<ul>
<li>This simply tells us that 3 tests have been found and are ready to
be run.</li>
</ul>
<pre><code>advanced/test_advanced_calculator.py .
test_calculator.py ..    [100%]</code></pre>
<ul>
<li>These two lines tells us that the tests in
<code>test_calculator.py</code> and
<code>advanced/test_advanced_calculator.py</code> have passed. Each
<code>.</code> means that a test has passed. There are two of them
beside <code>test_calculator.py</code> because there are two tests in
<code>test_calculator.py</code> If a test fails, it will show an
<code>F</code> instead of a <code>.</code>.</li>
</ul>
<div style="color:green">
<pre><code>=== 3 passed in 0.01s ===</code></pre>
</div>
<ul>
<li>This tells us that the 3 tests have passed in 0.01 seconds.</li>
</ul>
</div>
<div class="section level3">
<h3 id="case-2-some-or-all-tests-fail">Case 2: Some or all tests fail<a class="anchor" aria-label="anchor" href="#case-2-some-or-all-tests-fail"></a>
</h3>
<p>Now let’s look at the output when the tests fail. Edit a test in
<code>test_calculator.py</code> to make it fail (for example switching
the <code>+</code> in <code>add</code> to a <code>-</code>), then run
<code>pytest</code> again.</p>
<p>The start is much the same as before:</p>
<pre><code>=== test session starts ===
platform darwin -- Python 3.11.0, pytest-8.1.1, pluggy-1.4.0
rootdir: /Users/sylvi/Documents/GitKraken/python-testing-for-research/episodes/files/03-interacting-with-tests
plugins: regtest-2.1.1
collected 3 items</code></pre>
<p>But now we see that the tests have failed:</p>
<pre><code>advanced/test_advanced_calculator.py .                                                                                                                                                                                                                                                                                                                                      [ 33%]
test_calculator.py F. </code></pre>
<p>These <code>F</code> tells us that a test has failed. The output then
tells us which test has failed:</p>
<pre><code>=== FAILURES ===

___ test_add ___
    def test_add():
        """Test for the add function"""
&gt;       assert add(1, 2) == 3
E       assert -1 == 3
E       +  where -1 = add(1, 2)

test_calculator.py:21: AssertionError</code></pre>
<p>This is where we get detailled information about what exactly broke
in the test.</p>
<ul>
<li>The <code>&gt;</code> chevron points to the line that failed in the
test. In this case, the assertion <code>assert add(1, 2) == 3</code>
failed.</li>
<li>The following line tells us what the assertion tried to do. In this
case, it tried to assert that the number -1 was equal to 3. Which of
course it isn’t.</li>
<li>The next line goes into more detail about why it tried to equate -1
to 3. It tells us that -1 is the result of calling
<code>add(1, 2)</code>.</li>
<li>The final line tells us where the test failed. In this case, it was
on line 21 of <code>test_calculator.py</code>.</li>
</ul>
<p>Using this detailled output, we can quickly find the exact line that
failed and know the inputs that caused the failure. From there, we can
examine exactly what went wrong and fix it.</p>
<p>Finally, pytest prints out a short summary of all the failed
tests:</p>
<pre><code>=== short test summary info ===
FAILED test_calculator.py::test_add - assert -1 == 3
=== 1 failed, 2 passed in 0.01s ===</code></pre>
<p>This tells us that one of our tests failed, and gives a short summary
of what went wrong in this test and finally tells us that it took 0.01s
to run the tests.</p>
</div>
</section><section><h2 class="section-heading" id="errors-in-collection">Errors in collection<a class="anchor" aria-label="anchor" href="#errors-in-collection"></a>
<a class="anchor" aria-label="anchor" href="#errors-in-collection"></a>
</h2>
<hr class="half-width">
<p>If pytest encounters an error while collecting the tests, it will
print out an error message and won’t run the tests. This happens when
there is a syntax error in one of the test files, or if pytest can’t
find the test files.</p>
<p>For example, if you remove the <code>:</code> from the end of the
<code>def test_multiply():</code> function definition and run pytest,
you will see the following output:</p>
<pre><code>=== test session starts ===
platform darwin -- Python 3.11.0, pytest-8.1.1, pluggy-1.4.0
Matplotlib: 3.9.0
Freetype: 2.6.1
rootdir: /Users/sylvi/Documents/GitKraken/python-testing-for-research/episodes/files/03-interacting-with-tests.Rmd
plugins: mpl-0.17.0, regtest-2.1.1
collected 1 item / 1 error

=== ERRORS ===
___ ERROR collecting test_calculator.py ___
...
E     File "/Users/sylvi/Documents/GitKraken/python-testing-for-research/episodes/files/03-interacting-with-tests.Rmd/test_calculator.py", line 14
E       def test_multiply()
E                          ^
E   SyntaxError: expected ':'
=== short test summary info ===
ERROR test_calculator.py
!!! Interrupted: 1 error during collection !!!
=== 1 error in 0.01s ===</code></pre>
<p>This rather scary output is just telling us that there is a syntax
error that needs fixing before the tests can be run.</p>
</section><section><h2 class="section-heading" id="pytest-options">Pytest options<a class="anchor" aria-label="anchor" href="#pytest-options"></a>
<a class="anchor" aria-label="anchor" href="#pytest-options"></a>
</h2>
<hr class="half-width">
<p>Pytest has a number of options that can be used to customize how
tests are run. It is very useful to know about these options as they can
help you to run tests the way you want and get more information if
necessary about a test run.</p>
<div class="section level3">
<h3 id="the-verbose-flag">The verbose flag<a class="anchor" aria-label="anchor" href="#the-verbose-flag"></a>
</h3>
<p>The verbose flag <code>-v</code> can be used to get more detailed
output from pytest. This can be useful when you want to see more
information about the tests that are being run. For example, running
<code>pytest -v</code> will give you more information about the tests
that are being run, including the names of the tests and the files that
they are in.</p>
</div>
<div class="section level3">
<h3 id="the-quiet-flag">The quiet flag<a class="anchor" aria-label="anchor" href="#the-quiet-flag"></a>
</h3>
<p>The quiet flag <code>-q</code> can be used to get less detailed
output from pytest. This can be useful when you want to see less
information about the tests that are being run. For example, running
<code>pytest -q</code> will give you less information about the tests
that are being run, including the names of the tests and the files that
they are in.</p>
</div>
<div class="section level3">
<h3 id="running-specific-tests">Running specific tests<a class="anchor" aria-label="anchor" href="#running-specific-tests"></a>
</h3>
<p>In order to run a specific test, you can use the <code>-k</code> flag
followed by the name of the test you want to run. For example, to run
only the <code>test_add</code> test, you can run
<code>pytest -k test_add</code>. This will only run the
<code>test_add</code> test and ignore the <code>test_multiply</code>
test.</p>
<p>Alternatively you can call a specific test using this notation:
<code>pytest test_calculator.py::test_add</code>. This tells pytest to
only run the <code>test_add</code> test in the
<code>test_calculator.py</code> file.</p>
</div>
<div class="section level3">
<h3 id="stopping-after-the-first-failure">Stopping after the first failure<a class="anchor" aria-label="anchor" href="#stopping-after-the-first-failure"></a>
</h3>
<p>If you want to stop running tests after the first failure, you can
use the <code>-x</code> flag. This will cause pytest to stop running
tests after the first failure. This is useful when you have lots of
tests that take a while to run.</p>
<div id="challenge---experiment-with-pytest-options" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge---experiment-with-pytest-options" class="callout-inner">
<h3 class="callout-title">Challenge - Experiment with pytest options<a class="anchor" aria-label="anchor" href="#challenge---experiment-with-pytest-options"></a>
</h3>
<div class="callout-content">
<p>Try running pytest with the above options, editing the code to make
the tests fail where necessary to see what happens.</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<ul>
<li><p>Run <code>pytest -v</code> to see more detailed output.</p></li>
<li><p>Run <code>pytest -q</code> to see less detailed output.</p></li>
<li><p>Run <code>pytest -k test_add</code> to run only the
<code>test_add</code> test.</p></li>
<li><p>Alternatively run
<code>pytest test_calculator.py::test_add</code> to run only the
<code>test_add</code> test.</p></li>
<li><p>Run <code>pytest -x</code> to stop running tests after the first
failure. (Make sure you have a failing test to see this in
action).</p></li>
</ul>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>You can run multiple tests at once by running <code>pytest</code> in
the terminal.</li>
<li>Pytest searches for tests in files that start or end with ‘test’ in
the current directory and subdirectories.</li>
<li>The output of pytest tells you which tests have passed and which
have failed and precisely why they failed.</li>
<li>Flags such as <code>-v</code>, <code>-q</code>, <code>-k</code>, and
<code>-x</code> can be used to get more detailed output, less detailed
output, run specific tests, and stop running tests after the first
failure, respectively.</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</div>
</section></section><section id="aio-04-unit-tests-best-practices"><p>Content from <a href="04-unit-tests-best-practices.html">Unit tests &amp; Testing Practices</a></p>
<hr>
<p>Last updated on 2024-07-09 |

        <a href="https://github.com/SylviaWhittle/python-testing-for-research/edit/main/episodes/04-unit-tests-best-practices.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What to do about complex functions &amp; tests?</li>
<li>What are some testing best practices for testing?</li>
<li>How far should I go with testing?</li>
<li>How do I add tests to an existing project?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Be able to write effective unit tests for more complex
functions</li>
<li>Understand the AAA pattern for structuring tests</li>
<li>Understand the benefits of test driven development</li>
<li>Know how to handle randomness in tests</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="but-what-about-complicated-functions">But what about complicated functions?<a class="anchor" aria-label="anchor" href="#but-what-about-complicated-functions"></a>
<a class="anchor" aria-label="anchor" href="#but-what-about-complicated-functions"></a>
</h2>
<hr class="half-width">
<p>Some of the functions that you write will be more complex, resulting
in tests that are very complex and hard to debug if they fail. Take this
function as an example:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="kw">def</span> process_data(data: <span class="bu">list</span>, maximum_value: <span class="bu">float</span>):</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>    <span class="co"># Remove negative values</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>    data_negative_removed <span class="op">=</span> []</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(data)):</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>        <span class="cf">if</span> data[i] <span class="op">&gt;=</span> <span class="dv">0</span>:</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>            data_negative_removed.append(data[i])</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>    <span class="co"># Remove values above the maximum value</span></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a>    data_maximum_removed <span class="op">=</span> []</span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(data_negative_removed)):</span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a>        <span class="cf">if</span> data_negative_removed[i] <span class="op">&lt;=</span> maximum_value:</span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a>            data_maximum_removed.append(data_negative_removed[i])</span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a>    </span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a>    <span class="co"># Calculate the mean</span></span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a>    mean <span class="op">=</span> <span class="bu">sum</span>(data_maximum_removed) <span class="op">/</span> <span class="bu">len</span>(data_maximum_removed)</span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a>    <span class="co"># Calculate the standard deviation</span></span>
<span id="cb1-19"><a href="#cb1-19" tabindex="-1"></a>    variance <span class="op">=</span> <span class="bu">sum</span>([(x <span class="op">-</span> mean) <span class="op">**</span> <span class="dv">2</span> <span class="cf">for</span> x <span class="kw">in</span> data_maximum_removed]) <span class="op">/</span> <span class="bu">len</span>(data_maximum_removed)</span>
<span id="cb1-20"><a href="#cb1-20" tabindex="-1"></a>    std_dev <span class="op">=</span> variance <span class="op">**</span> <span class="fl">0.5</span></span>
<span id="cb1-21"><a href="#cb1-21" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" tabindex="-1"></a>    <span class="cf">return</span> mean, std_dev</span></code></pre>
</div>
<p>A test for this function might look like this:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="kw">def</span> test_process_data():</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>    data <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">10</span>]</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>    maximum_value <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>    mean, std_dev <span class="op">=</span> process_data(data, maximum_value)</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>    <span class="cf">assert</span> mean <span class="op">==</span> <span class="dv">3</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>    <span class="cf">assert</span> std_dev <span class="op">==</span> <span class="fl">1.5811388300841898</span></span></code></pre>
</div>
<p>This test is very complex and hard to debug if it fails. Imagine if
the calculation of the mean broke - the test would fail but it would not
tell us what part of the function was broken, requiring us to check each
function manually to find the bug. Not very efficient!</p>
</section><section><h2 class="section-heading" id="unit-testing">Unit Testing<a class="anchor" aria-label="anchor" href="#unit-testing"></a>
<a class="anchor" aria-label="anchor" href="#unit-testing"></a>
</h2>
<hr class="half-width">
<p>The process of unit testing is a fundamental part of software
development. It is where you test individual units or components of a
software instead of multiple things at once. For example, if you were
adding tests to a car, you would want to test the wheels, the engine,
the brakes, etc. separately to make sure they all work as expected
before testing that the car could drive to the shops. The goal with unit
testing is to validate that each unit of the software performs as
designed. A unit is the smallest testable part of your code. A unit test
usually has one or a few inputs and usually a single output.</p>
<p>The above function could usefully be broken down into smaller
functions, each of which could be tested separately. This would make the
tests easier to write and maintain.</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="kw">def</span> remove_negative_values(data: <span class="bu">list</span>):</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>    data_negatives_removed <span class="op">=</span> []</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(data)):</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>        <span class="cf">if</span> data[i] <span class="op">&gt;=</span> <span class="dv">0</span>:</span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>            data_negatives_removed.append(data[i])</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>    <span class="cf">return</span> data</span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a><span class="kw">def</span> remove_values_above_maximum(data: <span class="bu">list</span>, maximum_value: <span class="bu">float</span>):</span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>    data_maximum_removed <span class="op">=</span> []</span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(data)):</span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a>        <span class="cf">if</span> data[i] <span class="op">&lt;=</span> maximum_value:</span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a>            data_maximum_removed.append(data[i])</span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a>    <span class="cf">return</span> data</span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a><span class="kw">def</span> calculate_mean(data: <span class="bu">list</span>):</span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">sum</span>(data) <span class="op">/</span> <span class="bu">len</span>(data)</span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a></span>
<span id="cb3-18"><a href="#cb3-18" tabindex="-1"></a><span class="kw">def</span> calculate_std_dev(data: <span class="bu">list</span>):</span>
<span id="cb3-19"><a href="#cb3-19" tabindex="-1"></a>    mean <span class="op">=</span> calculate_mean(data)</span>
<span id="cb3-20"><a href="#cb3-20" tabindex="-1"></a>    variance <span class="op">=</span> <span class="bu">sum</span>([(x <span class="op">-</span> mean) <span class="op">**</span> <span class="dv">2</span> <span class="cf">for</span> x <span class="kw">in</span> data]) <span class="op">/</span> <span class="bu">len</span>(data)</span>
<span id="cb3-21"><a href="#cb3-21" tabindex="-1"></a>    <span class="cf">return</span> variance <span class="op">**</span> <span class="fl">0.5</span></span>
<span id="cb3-22"><a href="#cb3-22" tabindex="-1"></a></span>
<span id="cb3-23"><a href="#cb3-23" tabindex="-1"></a><span class="kw">def</span> process_data(data: <span class="bu">list</span>, maximum_value: <span class="bu">float</span>):</span>
<span id="cb3-24"><a href="#cb3-24" tabindex="-1"></a>    <span class="co"># Remove negative values</span></span>
<span id="cb3-25"><a href="#cb3-25" tabindex="-1"></a>    data <span class="op">=</span> remove_negative_values(data)</span>
<span id="cb3-26"><a href="#cb3-26" tabindex="-1"></a>    <span class="co"># Remove values above the maximum value</span></span>
<span id="cb3-27"><a href="#cb3-27" tabindex="-1"></a>    data <span class="op">=</span> remove_values_above_maximum(data, maximum_value)</span>
<span id="cb3-28"><a href="#cb3-28" tabindex="-1"></a>    <span class="co"># Calculate the mean</span></span>
<span id="cb3-29"><a href="#cb3-29" tabindex="-1"></a>    mean <span class="op">=</span> calculate_mean(data)</span>
<span id="cb3-30"><a href="#cb3-30" tabindex="-1"></a>    <span class="co"># Calculate the standard deviation</span></span>
<span id="cb3-31"><a href="#cb3-31" tabindex="-1"></a>    std_dev <span class="op">=</span> calculate_std_dev(data)</span>
<span id="cb3-32"><a href="#cb3-32" tabindex="-1"></a>    <span class="cf">return</span> mean, std_dev</span></code></pre>
</div>
<p>Now we can write tests for each of these functions separately:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="kw">def</span> test_remove_negative_values():</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>    data <span class="op">=</span> [<span class="dv">1</span>, <span class="op">-</span><span class="dv">2</span>, <span class="dv">3</span>, <span class="op">-</span><span class="dv">4</span>, <span class="dv">5</span>, <span class="op">-</span><span class="dv">6</span>, <span class="dv">7</span>, <span class="op">-</span><span class="dv">8</span>, <span class="dv">9</span>, <span class="op">-</span><span class="dv">10</span>]</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>    <span class="cf">assert</span> remove_negative_values(data) <span class="op">==</span> [<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">9</span>]</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a><span class="kw">def</span> test_remove_values_above_maximum():</span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>    data <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">10</span>]</span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>    maximum_value <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a>    <span class="cf">assert</span> remove_values_above_maximum(data, maximum_value) <span class="op">==</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>]</span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a><span class="kw">def</span> test_calculate_mean():</span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a>    data <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>]</span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a>    <span class="cf">assert</span> calculate_mean(data) <span class="op">==</span> <span class="dv">3</span></span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a></span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a><span class="kw">def</span> test_calculate_std_dev():</span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a>    data <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>]</span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a>    <span class="cf">assert</span> calculate_std_dev(data) <span class="op">==</span> <span class="fl">1.5811388300841898</span></span>
<span id="cb4-17"><a href="#cb4-17" tabindex="-1"></a></span>
<span id="cb4-18"><a href="#cb4-18" tabindex="-1"></a><span class="kw">def</span> test_process_data():</span>
<span id="cb4-19"><a href="#cb4-19" tabindex="-1"></a>    data <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">10</span>]</span>
<span id="cb4-20"><a href="#cb4-20" tabindex="-1"></a>    maximum_value <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb4-21"><a href="#cb4-21" tabindex="-1"></a>    mean, std_dev <span class="op">=</span> process_data(data, maximum_value)</span>
<span id="cb4-22"><a href="#cb4-22" tabindex="-1"></a>    <span class="cf">assert</span> mean <span class="op">==</span> <span class="dv">3</span></span>
<span id="cb4-23"><a href="#cb4-23" tabindex="-1"></a>    <span class="cf">assert</span> std_dev <span class="op">==</span> <span class="fl">1.5811388300841898</span></span></code></pre>
</div>
<p>These tests are much easier to read and understand, and if one of
them fails, it is much easier to see which part of the function is
broken. This is the principle of unit testing: breaking down complex
functions into smaller, testable units.</p>
</section><section><h2 class="section-heading" id="aaa-pattern">AAA pattern<a class="anchor" aria-label="anchor" href="#aaa-pattern"></a>
<a class="anchor" aria-label="anchor" href="#aaa-pattern"></a>
</h2>
<hr class="half-width">
<p>When writing tests, it is a good idea to follow the AAA pattern:</p>
<ul>
<li>Arrange: Set up the data and the conditions for the test</li>
<li>Act: Perform the action that you are testing</li>
<li>Assert: Check that the result of the action is what you expect</li>
</ul>
<p>It is a standard pattern in unit testing and is used in many testing
frameworks. This makes your tests easier to read and understand for both
yourself and others reading your code.</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="kw">def</span> test_calculate_mean():</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>    <span class="co"># Arrange</span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>    data <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>]</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>    </span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>    <span class="co"># Act</span></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>    mean <span class="op">=</span> calculate_mean(data)</span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>    </span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a>    <span class="co"># Assert</span></span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a>    <span class="cf">assert</span> mean <span class="op">==</span> <span class="dv">3</span></span></code></pre>
</div>
</section><section><h2 class="section-heading" id="test-driven-development-tdd">Test Driven Development (TDD)<a class="anchor" aria-label="anchor" href="#test-driven-development-tdd"></a>
<a class="anchor" aria-label="anchor" href="#test-driven-development-tdd"></a>
</h2>
<hr class="half-width">
<p>Test Driven Development (TDD) is a software development process that
focuses on writing tests before writing the code. This can have several
benefits:</p>
<ul>
<li>It forces you to think about the requirements of the code before you
write it, this is especially useful in research.</li>
<li>It can help you to write cleaner, more modular code by breaking down
complex functions into smaller, testable units.</li>
<li>It can help you to catch bugs early in the development process.</li>
</ul>
<p>Without the test driven development process, you might write the code
first and then try to write tests for it afterwards. This can lead to
tests that are hard to write and maintain, and can result in bugs that
are hard to find and fix.</p>
<p>The TDD process usually follows these steps:</p>
<ol style="list-style-type: decimal">
<li>Write a failing test</li>
<li>Write the minimum amount of code to make the test pass</li>
<li>Refactor the code to make it clean and maintainable</li>
</ol>
<p>Here is an example of the TDD process:</p>
<ol style="list-style-type: decimal">
<li>Write a failing test</li>
</ol>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="kw">def</span> test_calculate_mean():</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>    <span class="co"># Arrange</span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>    data <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>]</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>    </span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>    <span class="co"># Act</span></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>    mean <span class="op">=</span> calculate_mean(data)</span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a>    </span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a>    <span class="co"># Assert</span></span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a>    <span class="cf">assert</span> mean <span class="op">==</span> <span class="fl">3.5</span></span></code></pre>
</div>
<ol start="2" style="list-style-type: decimal">
<li>Write the minimum amount of code to make the test pass</li>
</ol>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="kw">def</span> calculate_mean(data: <span class="bu">list</span>):</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>    total <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(data)):</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>        total <span class="op">+=</span> data[i]</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>    mean <span class="op">=</span> total <span class="op">/</span> <span class="bu">len</span>(data)</span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>    <span class="cf">return</span> mean</span></code></pre>
</div>
<ol start="3" style="list-style-type: decimal">
<li>Refactor the code to make it clean and maintainable</li>
</ol>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="kw">def</span> calculate_mean(data: <span class="bu">list</span>):</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(data) <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">0</span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">sum</span>(data) <span class="op">/</span> <span class="bu">len</span>(data)</span></code></pre>
</div>
<p>This process can help you to write clean, maintainable code that is
easy to test and debug.</p>
<p>Of course, in research, sometimes you might not know exactly what the
requirements of the code are before you write it. In this case, you can
still use the TDD process, but you might need to iterate on the tests
and the code as you learn more about the problem you are trying to
solve.</p>
</section><section><h2 class="section-heading" id="randomness-in-tests">Randomness in tests<a class="anchor" aria-label="anchor" href="#randomness-in-tests"></a>
<a class="anchor" aria-label="anchor" href="#randomness-in-tests"></a>
</h2>
<hr class="half-width">
<p>Some functions use randomness, which you might assume means we cannot
write tests for them. However using random seeds, we can make this
randomness deterministic and write tests for these functions.</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a><span class="kw">def</span> random_number():</span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>    <span class="cf">return</span> random.randint(<span class="dv">1</span>, <span class="dv">10</span>)</span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a><span class="kw">def</span> test_random_number():</span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a>    random.seed(<span class="dv">0</span>)</span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a>    <span class="cf">assert</span> random_number() <span class="op">==</span> <span class="dv">1</span></span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a>    <span class="cf">assert</span> random_number() <span class="op">==</span> <span class="dv">2</span></span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a>    <span class="cf">assert</span> random_number() <span class="op">==</span> <span class="dv">3</span></span></code></pre>
</div>
<p>Random seeds work by setting the initial state of the random number
generator. This means that if you set the seed to the same value, you
will get the same sequence of random numbers each time you run the
function.</p>
<div id="challenge-write-your-own-unit-tests" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-write-your-own-unit-tests" class="callout-inner">
<h3 class="callout-title">Challenge: Write your own unit tests<a class="anchor" aria-label="anchor" href="#challenge-write-your-own-unit-tests"></a>
</h3>
<div class="callout-content">
<p>Take this complex function, break it down and write unit tests for
it.</p>
<ul>
<li>Create a new directory called <code>statistics</code> in your
project directory</li>
<li>Create a new file called <code>stats.py</code> in the
<code>statistics</code> directory</li>
<li>Write the following function in <code>stats.py</code>:</li>
</ul>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a><span class="kw">def</span> randomly_sample_and_filter_participants(</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>    participants: <span class="bu">list</span>, </span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>    sample_size: <span class="bu">int</span>, </span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a>    min_age: <span class="bu">int</span>, </span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a>    max_age: <span class="bu">int</span>, </span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a>    min_height: <span class="bu">int</span>, </span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a>    max_height: <span class="bu">int</span></span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a>):</span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a>    <span class="co">"""Participants is a list of tuples, containing the age and height of each participant</span></span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a><span class="co">    participants = [</span></span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a><span class="co">                      {age: 25, height: 180}, </span></span>
<span id="cb10-14"><a href="#cb10-14" tabindex="-1"></a><span class="co">                      {age: 30, height: 170}, </span></span>
<span id="cb10-15"><a href="#cb10-15" tabindex="-1"></a><span class="co">                      {age: 35, height: 160}, </span></span>
<span id="cb10-16"><a href="#cb10-16" tabindex="-1"></a><span class="co">    ]</span></span>
<span id="cb10-17"><a href="#cb10-17" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb10-18"><a href="#cb10-18" tabindex="-1"></a>    </span>
<span id="cb10-19"><a href="#cb10-19" tabindex="-1"></a>    <span class="co"># Get the indexes to sample</span></span>
<span id="cb10-20"><a href="#cb10-20" tabindex="-1"></a>    indexes <span class="op">=</span> random.sample(<span class="bu">range</span>(<span class="bu">len</span>(participants)), sample_size)</span>
<span id="cb10-21"><a href="#cb10-21" tabindex="-1"></a></span>
<span id="cb10-22"><a href="#cb10-22" tabindex="-1"></a>    <span class="co"># Get the sampled participants</span></span>
<span id="cb10-23"><a href="#cb10-23" tabindex="-1"></a>    sampled_participants <span class="op">=</span> []</span>
<span id="cb10-24"><a href="#cb10-24" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> indexes:</span>
<span id="cb10-25"><a href="#cb10-25" tabindex="-1"></a>        sampled_participants.append(participants[i])</span>
<span id="cb10-26"><a href="#cb10-26" tabindex="-1"></a>    </span>
<span id="cb10-27"><a href="#cb10-27" tabindex="-1"></a>    <span class="co"># Remove participants that are outside the age range</span></span>
<span id="cb10-28"><a href="#cb10-28" tabindex="-1"></a>    sampled_participants_age_filtered <span class="op">=</span> []</span>
<span id="cb10-29"><a href="#cb10-29" tabindex="-1"></a>    <span class="cf">for</span> participant <span class="kw">in</span> sampled_participants:</span>
<span id="cb10-30"><a href="#cb10-30" tabindex="-1"></a>        <span class="cf">if</span> participant[<span class="st">'age'</span>] <span class="op">&gt;=</span> min_age <span class="kw">and</span> participant[<span class="st">'age'</span>] <span class="op">&lt;=</span> max_age:</span>
<span id="cb10-31"><a href="#cb10-31" tabindex="-1"></a>            sampled_participants_age_filtered.append(participant)</span>
<span id="cb10-32"><a href="#cb10-32" tabindex="-1"></a>    </span>
<span id="cb10-33"><a href="#cb10-33" tabindex="-1"></a>    <span class="co"># Remove participants that are outside the height range</span></span>
<span id="cb10-34"><a href="#cb10-34" tabindex="-1"></a>    sampled_participants_height_filtered <span class="op">=</span> []</span>
<span id="cb10-35"><a href="#cb10-35" tabindex="-1"></a>    <span class="cf">for</span> participant <span class="kw">in</span> sampled_participants_age_filtered:</span>
<span id="cb10-36"><a href="#cb10-36" tabindex="-1"></a>        <span class="cf">if</span> participant[<span class="st">'height'</span>] <span class="op">&gt;=</span> min_height <span class="kw">and</span> participant[<span class="st">'height'</span>] <span class="op">&lt;=</span> max_height:</span>
<span id="cb10-37"><a href="#cb10-37" tabindex="-1"></a>            sampled_participants_height_filtered.append(participant)</span>
<span id="cb10-38"><a href="#cb10-38" tabindex="-1"></a></span>
<span id="cb10-39"><a href="#cb10-39" tabindex="-1"></a>    <span class="cf">return</span> sampled_participants_height_filtered</span></code></pre>
</div>
<ul>
<li>Create a new file called <code>test_stats.py</code> in the
<code>statistics</code> directory</li>
<li>Write unit tests for the
<code>randomly_sample_and_filter_participants</code> function in
<code>test_stats.py</code>
</li>
</ul>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<p>The function can be broken down into smaller functions, each of which
can be tested separately:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a><span class="kw">def</span> sample_participants(</span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>    participants: <span class="bu">list</span>, </span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a>    sample_size: <span class="bu">int</span></span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a>):</span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a>    indexes <span class="op">=</span> random.sample(<span class="bu">range</span>(<span class="bu">len</span>(participants)), sample_size)</span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a>    sampled_participants <span class="op">=</span> []</span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> indexes:</span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a>        sampled_participants.append(participants[i])</span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a>    <span class="cf">return</span> sampled_participants</span>
<span id="cb11-12"><a href="#cb11-12" tabindex="-1"></a></span>
<span id="cb11-13"><a href="#cb11-13" tabindex="-1"></a><span class="kw">def</span> filter_participants_by_age(</span>
<span id="cb11-14"><a href="#cb11-14" tabindex="-1"></a>    participants: <span class="bu">list</span>, </span>
<span id="cb11-15"><a href="#cb11-15" tabindex="-1"></a>    min_age: <span class="bu">int</span>, </span>
<span id="cb11-16"><a href="#cb11-16" tabindex="-1"></a>    max_age: <span class="bu">int</span></span>
<span id="cb11-17"><a href="#cb11-17" tabindex="-1"></a>):</span>
<span id="cb11-18"><a href="#cb11-18" tabindex="-1"></a>    filtered_participants <span class="op">=</span> []</span>
<span id="cb11-19"><a href="#cb11-19" tabindex="-1"></a>    <span class="cf">for</span> participant <span class="kw">in</span> participants:</span>
<span id="cb11-20"><a href="#cb11-20" tabindex="-1"></a>        <span class="cf">if</span> participant[<span class="st">'age'</span>] <span class="op">&gt;=</span> min_age <span class="kw">and</span> participant[<span class="st">'age'</span>] <span class="op">&lt;=</span> max_age:</span>
<span id="cb11-21"><a href="#cb11-21" tabindex="-1"></a>            filtered_participants.append(participant)</span>
<span id="cb11-22"><a href="#cb11-22" tabindex="-1"></a>    <span class="cf">return</span> filtered_participants</span>
<span id="cb11-23"><a href="#cb11-23" tabindex="-1"></a></span>
<span id="cb11-24"><a href="#cb11-24" tabindex="-1"></a><span class="kw">def</span> filter_participants_by_height(</span>
<span id="cb11-25"><a href="#cb11-25" tabindex="-1"></a>    participants: <span class="bu">list</span>, </span>
<span id="cb11-26"><a href="#cb11-26" tabindex="-1"></a>    min_height: <span class="bu">int</span>, </span>
<span id="cb11-27"><a href="#cb11-27" tabindex="-1"></a>    max_height: <span class="bu">int</span></span>
<span id="cb11-28"><a href="#cb11-28" tabindex="-1"></a>):</span>
<span id="cb11-29"><a href="#cb11-29" tabindex="-1"></a>    filtered_participants <span class="op">=</span> []</span>
<span id="cb11-30"><a href="#cb11-30" tabindex="-1"></a>    <span class="cf">for</span> participant <span class="kw">in</span> participants:</span>
<span id="cb11-31"><a href="#cb11-31" tabindex="-1"></a>        <span class="cf">if</span> participant[<span class="st">'height'</span>] <span class="op">&gt;=</span> min_height <span class="kw">and</span> participant[<span class="st">'height'</span>] <span class="op">&lt;=</span> max_height:</span>
<span id="cb11-32"><a href="#cb11-32" tabindex="-1"></a>            filtered_participants.append(participant)</span>
<span id="cb11-33"><a href="#cb11-33" tabindex="-1"></a>    <span class="cf">return</span> filtered_participants</span>
<span id="cb11-34"><a href="#cb11-34" tabindex="-1"></a></span>
<span id="cb11-35"><a href="#cb11-35" tabindex="-1"></a><span class="kw">def</span> randomly_sample_and_filter_participants(</span>
<span id="cb11-36"><a href="#cb11-36" tabindex="-1"></a>    participants: <span class="bu">list</span>, </span>
<span id="cb11-37"><a href="#cb11-37" tabindex="-1"></a>    sample_size: <span class="bu">int</span>, </span>
<span id="cb11-38"><a href="#cb11-38" tabindex="-1"></a>    min_age: <span class="bu">int</span>, </span>
<span id="cb11-39"><a href="#cb11-39" tabindex="-1"></a>    max_age: <span class="bu">int</span>, </span>
<span id="cb11-40"><a href="#cb11-40" tabindex="-1"></a>    min_height: <span class="bu">int</span>, </span>
<span id="cb11-41"><a href="#cb11-41" tabindex="-1"></a>    max_height: <span class="bu">int</span></span>
<span id="cb11-42"><a href="#cb11-42" tabindex="-1"></a>):</span>
<span id="cb11-43"><a href="#cb11-43" tabindex="-1"></a>    sampled_participants <span class="op">=</span> sample_participants(participants, sample_size)</span>
<span id="cb11-44"><a href="#cb11-44" tabindex="-1"></a>    age_filtered_participants <span class="op">=</span> filter_participants_by_age(sampled_participants, min_age, max_age)</span>
<span id="cb11-45"><a href="#cb11-45" tabindex="-1"></a>    height_filtered_participants <span class="op">=</span> filter_participants_by_height(age_filtered_participants, min_height, max_height)</span>
<span id="cb11-46"><a href="#cb11-46" tabindex="-1"></a>    <span class="cf">return</span> height_filtered_participants</span></code></pre>
</div>
<p>Now we can write tests for each of these functions separately,
remembering to set the random seed to make the randomness
deterministic:</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a><span class="kw">def</span> test_sample_participants():</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>    <span class="co"># set random seed</span></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>    random.seed(<span class="dv">0</span>)</span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a>    participants <span class="op">=</span> [</span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a>        {<span class="st">'age'</span>: <span class="dv">25</span>, <span class="st">'height'</span>: <span class="dv">180</span>},</span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a>        {<span class="st">'age'</span>: <span class="dv">30</span>, <span class="st">'height'</span>: <span class="dv">170</span>},</span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a>        {<span class="st">'age'</span>: <span class="dv">35</span>, <span class="st">'height'</span>: <span class="dv">160</span>},</span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a>    ]</span>
<span id="cb12-12"><a href="#cb12-12" tabindex="-1"></a>    sample_size <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb12-13"><a href="#cb12-13" tabindex="-1"></a>    sampled_participants <span class="op">=</span> sample_participants(participants, sample_size)</span>
<span id="cb12-14"><a href="#cb12-14" tabindex="-1"></a>    expected <span class="op">=</span> [{<span class="st">'age'</span>: <span class="dv">30</span>, <span class="st">'height'</span>: <span class="dv">170</span>}, {<span class="st">'age'</span>: <span class="dv">35</span>, <span class="st">'height'</span>: <span class="dv">160</span>}]</span>
<span id="cb12-15"><a href="#cb12-15" tabindex="-1"></a>    <span class="cf">assert</span> sampled_participants <span class="op">==</span> expected</span>
<span id="cb12-16"><a href="#cb12-16" tabindex="-1"></a></span>
<span id="cb12-17"><a href="#cb12-17" tabindex="-1"></a><span class="kw">def</span> test_filter_participants_by_age():</span>
<span id="cb12-18"><a href="#cb12-18" tabindex="-1"></a>    participants <span class="op">=</span> [</span>
<span id="cb12-19"><a href="#cb12-19" tabindex="-1"></a>        {<span class="st">'age'</span>: <span class="dv">25</span>, <span class="st">'height'</span>: <span class="dv">180</span>},</span>
<span id="cb12-20"><a href="#cb12-20" tabindex="-1"></a>        {<span class="st">'age'</span>: <span class="dv">30</span>, <span class="st">'height'</span>: <span class="dv">170</span>},</span>
<span id="cb12-21"><a href="#cb12-21" tabindex="-1"></a>        {<span class="st">'age'</span>: <span class="dv">35</span>, <span class="st">'height'</span>: <span class="dv">160</span>},</span>
<span id="cb12-22"><a href="#cb12-22" tabindex="-1"></a>    ]</span>
<span id="cb12-23"><a href="#cb12-23" tabindex="-1"></a>    min_age <span class="op">=</span> <span class="dv">30</span></span>
<span id="cb12-24"><a href="#cb12-24" tabindex="-1"></a>    max_age <span class="op">=</span> <span class="dv">35</span></span>
<span id="cb12-25"><a href="#cb12-25" tabindex="-1"></a>    filtered_participants <span class="op">=</span> filter_participants_by_age(participants, min_age, max_age)</span>
<span id="cb12-26"><a href="#cb12-26" tabindex="-1"></a>    expected <span class="op">=</span> [{<span class="st">'age'</span>: <span class="dv">30</span>, <span class="st">'height'</span>: <span class="dv">170</span>}, {<span class="st">'age'</span>: <span class="dv">35</span>, <span class="st">'height'</span>: <span class="dv">160</span>}]</span>
<span id="cb12-27"><a href="#cb12-27" tabindex="-1"></a>    <span class="cf">assert</span> filtered_participants <span class="op">==</span> expected</span>
<span id="cb12-28"><a href="#cb12-28" tabindex="-1"></a></span>
<span id="cb12-29"><a href="#cb12-29" tabindex="-1"></a><span class="kw">def</span> test_filter_participants_by_height():</span>
<span id="cb12-30"><a href="#cb12-30" tabindex="-1"></a>    participants <span class="op">=</span> [</span>
<span id="cb12-31"><a href="#cb12-31" tabindex="-1"></a>        {<span class="st">'age'</span>: <span class="dv">25</span>, <span class="st">'height'</span>: <span class="dv">180</span>},</span>
<span id="cb12-32"><a href="#cb12-32" tabindex="-1"></a>        {<span class="st">'age'</span>: <span class="dv">30</span>, <span class="st">'height'</span>: <span class="dv">170</span>},</span>
<span id="cb12-33"><a href="#cb12-33" tabindex="-1"></a>        {<span class="st">'age'</span>: <span class="dv">35</span>, <span class="st">'height'</span>: <span class="dv">160</span>},</span>
<span id="cb12-34"><a href="#cb12-34" tabindex="-1"></a>    ]</span>
<span id="cb12-35"><a href="#cb12-35" tabindex="-1"></a>    min_height <span class="op">=</span> <span class="dv">160</span></span>
<span id="cb12-36"><a href="#cb12-36" tabindex="-1"></a>    max_height <span class="op">=</span> <span class="dv">170</span></span>
<span id="cb12-37"><a href="#cb12-37" tabindex="-1"></a>    filtered_participants <span class="op">=</span> filter_participants_by_height(participants, min_height, max_height)</span>
<span id="cb12-38"><a href="#cb12-38" tabindex="-1"></a>    expected <span class="op">=</span> [{<span class="st">'age'</span>: <span class="dv">30</span>, <span class="st">'height'</span>: <span class="dv">170</span>}, {<span class="st">'age'</span>: <span class="dv">35</span>, <span class="st">'height'</span>: <span class="dv">160</span>}]</span>
<span id="cb12-39"><a href="#cb12-39" tabindex="-1"></a>    <span class="cf">assert</span> filtered_participants <span class="op">==</span> expected</span>
<span id="cb12-40"><a href="#cb12-40" tabindex="-1"></a></span>
<span id="cb12-41"><a href="#cb12-41" tabindex="-1"></a><span class="kw">def</span> test_randomly_sample_and_filter_participants():</span>
<span id="cb12-42"><a href="#cb12-42" tabindex="-1"></a>    <span class="co"># set random seed</span></span>
<span id="cb12-43"><a href="#cb12-43" tabindex="-1"></a>    random.seed(<span class="dv">0</span>)</span>
<span id="cb12-44"><a href="#cb12-44" tabindex="-1"></a></span>
<span id="cb12-45"><a href="#cb12-45" tabindex="-1"></a>    participants <span class="op">=</span> [</span>
<span id="cb12-46"><a href="#cb12-46" tabindex="-1"></a>        {<span class="st">"age"</span>: <span class="dv">25</span>, <span class="st">"height"</span>: <span class="dv">180</span>},</span>
<span id="cb12-47"><a href="#cb12-47" tabindex="-1"></a>        {<span class="st">"age"</span>: <span class="dv">30</span>, <span class="st">"height"</span>: <span class="dv">170</span>},</span>
<span id="cb12-48"><a href="#cb12-48" tabindex="-1"></a>        {<span class="st">"age"</span>: <span class="dv">35</span>, <span class="st">"height"</span>: <span class="dv">160</span>},</span>
<span id="cb12-49"><a href="#cb12-49" tabindex="-1"></a>        {<span class="st">"age"</span>: <span class="dv">38</span>, <span class="st">"height"</span>: <span class="dv">165</span>},</span>
<span id="cb12-50"><a href="#cb12-50" tabindex="-1"></a>        {<span class="st">"age"</span>: <span class="dv">40</span>, <span class="st">"height"</span>: <span class="dv">190</span>},</span>
<span id="cb12-51"><a href="#cb12-51" tabindex="-1"></a>        {<span class="st">"age"</span>: <span class="dv">45</span>, <span class="st">"height"</span>: <span class="dv">200</span>},</span>
<span id="cb12-52"><a href="#cb12-52" tabindex="-1"></a>    ]</span>
<span id="cb12-53"><a href="#cb12-53" tabindex="-1"></a>    sample_size <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb12-54"><a href="#cb12-54" tabindex="-1"></a>    min_age <span class="op">=</span> <span class="dv">28</span></span>
<span id="cb12-55"><a href="#cb12-55" tabindex="-1"></a>    max_age <span class="op">=</span> <span class="dv">42</span></span>
<span id="cb12-56"><a href="#cb12-56" tabindex="-1"></a>    min_height <span class="op">=</span> <span class="dv">159</span></span>
<span id="cb12-57"><a href="#cb12-57" tabindex="-1"></a>    max_height <span class="op">=</span> <span class="dv">172</span></span>
<span id="cb12-58"><a href="#cb12-58" tabindex="-1"></a>    filtered_participants <span class="op">=</span> randomly_sample_and_filter_participants(</span>
<span id="cb12-59"><a href="#cb12-59" tabindex="-1"></a>        participants, sample_size, min_age, max_age, min_height, max_height</span>
<span id="cb12-60"><a href="#cb12-60" tabindex="-1"></a>    )</span>
<span id="cb12-61"><a href="#cb12-61" tabindex="-1"></a>    expected <span class="op">=</span> [{<span class="st">"age"</span>: <span class="dv">38</span>, <span class="st">"height"</span>: <span class="dv">165</span>}, {<span class="st">"age"</span>: <span class="dv">30</span>, <span class="st">"height"</span>: <span class="dv">170</span>}, {<span class="st">"age"</span>: <span class="dv">35</span>, <span class="st">"height"</span>: <span class="dv">160</span>}]</span>
<span id="cb12-62"><a href="#cb12-62" tabindex="-1"></a>    <span class="cf">assert</span> filtered_participants <span class="op">==</span> expected</span></code></pre>
</div>
<p>These tests are much easier to read and understand, and if one of
them fails, it is much easier to see which part of the function is
broken.</p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="adding-tests-to-an-existing-project">Adding tests to an existing project<a class="anchor" aria-label="anchor" href="#adding-tests-to-an-existing-project"></a>
<a class="anchor" aria-label="anchor" href="#adding-tests-to-an-existing-project"></a>
</h2>
<hr class="half-width">
<p>You may have an existing project that does not have any tests yet.
Adding tests to an existing project can be a daunting task and it can be
hard to know where to start.</p>
<p>In general, it’s a good idea to start by adding regression tests to
your most important functions. Regression tests are tests that simply
check that the output of a function doesn’t change when you make changes
to the code. They don’t check the individual components of the functions
like unit testing does.</p>
<p>For example if you had a long processing pipeline that returns a
single number, 23 when provided a certain set of inputs, you could write
a regression test that checks that the output is still 23 when you make
changes to the code.</p>
<p>After adding regression tests, you can start adding unit tests to the
individual functions in your code, starting with the more commonly used
/ likely to break functions such as ones that handle data processing or
input/output.</p>
</section><section><h2 class="section-heading" id="should-we-aim-for-100-test-coverage">Should we aim for 100% test coverage?<a class="anchor" aria-label="anchor" href="#should-we-aim-for-100-test-coverage"></a>
<a class="anchor" aria-label="anchor" href="#should-we-aim-for-100-test-coverage"></a>
</h2>
<hr class="half-width">
<p>Although tests add reliability to your code, it’s not always
practicable to spend so much development time writing tests. When time
is limited, it’s often better to only write tests for the most critical
parts of the code as opposed to rigorously testing every function.</p>
<p>You should discuss with your team how much of the code you think
should be tested, and what the most critical parts of the code are in
order to prioritize your time.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Complex functions can be broken down into smaller, testable
units.</li>
<li>Testing each unit separately is called unit testing.</li>
<li>The AAA pattern is a good way to structure your tests.</li>
<li>Test driven development can help you to write clean, maintainable
code.</li>
<li>Randomness in tests can be made deterministic using random
seeds.</li>
<li>Adding tests to an existing project can be done incrementally,
starting with regression tests.</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-05-testing-exceptions"><p>Content from <a href="05-testing-exceptions.html">Testing for Exceptions</a></p>
<hr>
<p>Last updated on 2024-07-09 |

        <a href="https://github.com/SylviaWhittle/python-testing-for-research/edit/main/episodes/05-testing-exceptions.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How check that a function raises an exception?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Learn how to test exceptions using <code>pytest.raises</code>.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="what-to-do-about-code-that-raises-exceptions">What to do about code that raises exceptions?<a class="anchor" aria-label="anchor" href="#what-to-do-about-code-that-raises-exceptions"></a>
<a class="anchor" aria-label="anchor" href="#what-to-do-about-code-that-raises-exceptions"></a>
</h2>
<hr class="half-width">
<p>Sometimes you will want to make sure that a function raises an
exception when it should. For example, you might want to check that a
function raises a <code>ValueError</code> when it receives an invalid
input.</p>
<p>Take this example of the <code>square_root</code> function. We don’t
have time to implement complex numbers yet, so we can raise a
<code>ValueError</code> when the input is negative to crash a program
that tries to compute the square root of a negative number.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="kw">def</span> square_root(x):</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>   <span class="cf">if</span> x <span class="op">&lt;</span> <span class="dv">0</span>:</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>      <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"Cannot compute square root of negative number yet!"</span>)</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>   <span class="cf">return</span> x <span class="op">**</span> <span class="fl">0.5</span></span></code></pre>
</div>
<p>We can test that the function raises an exception using
<code>pytest.raises</code> as follows:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="im">import</span> pytest</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="im">from</span> advanced.advanced_calculator <span class="im">import</span> square_root</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a><span class="kw">def</span> test_square_root():</span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>    <span class="cf">with</span> pytest.raises(<span class="pp">ValueError</span>):</span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>        square_root(<span class="op">-</span><span class="dv">1</span>)</span></code></pre>
</div>
<p>Here, <code>pytest.raises</code> is a context manager that checks
that the code inside the <code>with</code> block raises a
<code>ValueError</code> exception. If it doesn’t, the test fails.</p>
<p>If you want to get more detailled with things, you can test what the
error message says too:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="kw">def</span> test_square_root():</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>    <span class="cf">with</span> pytest.raises(<span class="pp">ValueError</span>) <span class="im">as</span> e:</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>        square_root(<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>    <span class="cf">assert</span> <span class="bu">str</span>(e.value) <span class="op">==</span> <span class="st">"Cannot compute square root of negative number yet!"</span></span></code></pre>
</div>
<div id="challenge-ensure-that-the-divide-function-raises-a-zerodivisionerror-when-the-denominator-is-zero." class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-ensure-that-the-divide-function-raises-a-zerodivisionerror-when-the-denominator-is-zero." class="callout-inner">
<h3 class="callout-title">Challenge : Ensure that the divide function raises a ZeroDivisionError when the denominator is zero.<a class="anchor" aria-label="anchor" href="#challenge-ensure-that-the-divide-function-raises-a-zerodivisionerror-when-the-denominator-is-zero."></a>
</h3>
<div class="callout-content">
<ul>
<li>Add a divide function to <code>calculator.py</code>:</li>
</ul>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="kw">def</span> divide(numerator, denominator):</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>    <span class="cf">if</span> denominator <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ZeroDivisionError</span>(<span class="st">"Cannot divide by zero!"</span>)</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>    <span class="cf">return</span> numerator <span class="op">/</span> denominator</span></code></pre>
</div>
<ul>
<li>Write a test in <code>test_calculator.py</code> that checks that the
divide function raises a <code>ZeroDivisionError</code> when the
denominator is zero.</li>
</ul>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="im">import</span> pytest</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="im">from</span> calculator <span class="im">import</span> divide</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a><span class="kw">def</span> test_divide():</span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>    <span class="cf">with</span> pytest.raises(<span class="pp">ZeroDivisionError</span>):</span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>        divide(<span class="dv">1</span>, <span class="dv">0</span>)</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Use <code>pytest.raises</code> to check that a function raises an
exception.</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-06-testing-data-structures"><p>Content from <a href="06-testing-data-structures.html">Testing Data Structures</a></p>
<hr>
<p>Last updated on 2024-07-09 |

        <a href="https://github.com/SylviaWhittle/python-testing-for-research/edit/main/episodes/06-testing-data-structures.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do you compare data structures such as lists and
dictionaries?</li>
<li>How do you compare objects in libraries like <code>pandas</code> and
<code>numpy</code>?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Learn how to compare lists and dictionaries in Python.</li>
<li>Learn how to compare objects in libraries like <code>pandas</code>
and <code>numpy</code>.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="data-structures">Data structures<a class="anchor" aria-label="anchor" href="#data-structures"></a>
<a class="anchor" aria-label="anchor" href="#data-structures"></a>
</h2>
<hr class="half-width">
<p>When writing tests for your code, you often need to compare data
structures such as lists, dictionaries, and objects from libraries like
<code>numpy</code> and <code>pandas</code>. Here we will go over some of
the more common data structures that you may use in research and how to
test them.</p>
<div class="section level3">
<h3 id="lists">Lists<a class="anchor" aria-label="anchor" href="#lists"></a>
</h3>
<p>Python lists can be tested using the usual <code>==</code> operator
as we do for numbers.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="kw">def</span> test_lists_equal():</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>    <span class="co">"""Test that lists are equal"""</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>    <span class="co"># Create two lists</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>    list1 <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>]</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>    list2 <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>]</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>    <span class="co"># Check that the lists are equal</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>    <span class="cf">assert</span> list1 <span class="op">==</span> list2</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a>    <span class="co"># Two lists, different order</span></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a>    list3 <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>]</span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a>    list4 <span class="op">=</span> [<span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">1</span>]</span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a>    <span class="cf">assert</span> list3 <span class="op">!=</span> list4</span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a>    <span class="co"># Create two different lists</span></span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a>    list5 <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>]</span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a>    list6 <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>]</span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a>    <span class="co"># Check that the lists are not equal</span></span>
<span id="cb1-19"><a href="#cb1-19" tabindex="-1"></a>    <span class="cf">assert</span> list5 <span class="op">!=</span> list6</span></code></pre>
</div>
<p>Note that the order of elements in the list matters. If you want to
check that two lists contain the same elements but in different order,
you can use the <code>sorted</code> function.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="kw">def</span> test_sorted_lists_equal():</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>    <span class="co">"""Test that lists are equal"""</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>    <span class="co"># Create two lists</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>    list1 <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>]</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>    list2 <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>]</span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>    <span class="co"># Check that the lists are equal</span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>    <span class="cf">assert</span> <span class="bu">sorted</span>(list1) <span class="op">==</span> <span class="bu">sorted</span>(list2)</span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a>    <span class="co"># Two lists, different order</span></span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a>    list3 <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>]</span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a>    list4 <span class="op">=</span> [<span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">1</span>]</span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a>    <span class="cf">assert</span> <span class="bu">sorted</span>(list3) <span class="op">==</span> <span class="bu">sorted</span>(list4)</span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a>    <span class="co"># Create two different lists</span></span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a>    list5 <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>]</span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a>    list6 <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>]</span>
<span id="cb2-17"><a href="#cb2-17" tabindex="-1"></a>    <span class="co"># Check that the lists are not equal</span></span>
<span id="cb2-18"><a href="#cb2-18" tabindex="-1"></a>    <span class="cf">assert</span> <span class="bu">sorted</span>(list5) <span class="op">!=</span> <span class="bu">sorted</span>(list6)</span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="dictionaries">Dictionaries<a class="anchor" aria-label="anchor" href="#dictionaries"></a>
</h3>
<p>Python dictionaries can also be tested using the <code>==</code>
operator, however, the order of the keys does not matter. This means
that if you have two dictionaries with the same keys and values, but in
different order, they will still be considered equal.</p>
<p>The reason for this is that dictionaries are unordered collections of
key-value pairs. (If you need to preserve the order of keys, you can use
the <code>collections.OrderedDict</code> class.)</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="kw">def</span> test_dictionaries_equal():</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>    <span class="co">"""Test that dictionaries are equal"""</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>    <span class="co"># Create two dictionaries</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>    dict1 <span class="op">=</span> {<span class="st">"a"</span>: <span class="dv">1</span>, <span class="st">"b"</span>: <span class="dv">2</span>, <span class="st">"c"</span>: <span class="dv">3</span>}</span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>    dict2 <span class="op">=</span> {<span class="st">"a"</span>: <span class="dv">1</span>, <span class="st">"b"</span>: <span class="dv">2</span>, <span class="st">"c"</span>: <span class="dv">3</span>}</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>    <span class="co"># Check that the dictionaries are equal</span></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>    <span class="cf">assert</span> dict1 <span class="op">==</span> dict2</span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>    <span class="co"># Create two dictionaries, different order</span></span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a>    dict3 <span class="op">=</span> {<span class="st">"a"</span>: <span class="dv">1</span>, <span class="st">"b"</span>: <span class="dv">2</span>, <span class="st">"c"</span>: <span class="dv">3</span>}</span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a>    dict4 <span class="op">=</span> {<span class="st">"c"</span>: <span class="dv">3</span>, <span class="st">"b"</span>: <span class="dv">2</span>, <span class="st">"a"</span>: <span class="dv">1</span>}</span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a>    <span class="cf">assert</span> dict3 <span class="op">==</span> dict4</span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a></span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a>    <span class="co"># Create two different dictionaries</span></span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a>    dict5 <span class="op">=</span> {<span class="st">"a"</span>: <span class="dv">1</span>, <span class="st">"b"</span>: <span class="dv">2</span>, <span class="st">"c"</span>: <span class="dv">3</span>}</span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a>    dict6 <span class="op">=</span> {<span class="st">"a"</span>: <span class="dv">1</span>, <span class="st">"b"</span>: <span class="dv">2</span>, <span class="st">"c"</span>: <span class="dv">4</span>}</span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a>    <span class="co"># Check that the dictionaries are not equal</span></span>
<span id="cb3-18"><a href="#cb3-18" tabindex="-1"></a>    <span class="cf">assert</span> dict5 <span class="op">!=</span> dict6</span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="numpy">numpy<a class="anchor" aria-label="anchor" href="#numpy"></a>
</h3>
<p>Numpy is a common library used in research. Instead of the usual
<code>assert a == b</code>, numpy has its own testing functions that are
more suitable for comparing numpy arrays. These two functions are the
ones you are most likely to use: -
<code>numpy.testing.assert_array_equal</code> is used to compare two
numpy arrays. - <code>numpy.testing.assert_allclose</code> is used to
compare two numpy arrays with a tolerance for floating point numbers. -
<code>numpy.testing.assert_equal</code> is used to compare two objects
such as lists or dictionaries that contain numpy arrays.</p>
<p>Here are some examples of how to use these functions:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="kw">def</span> test_numpy_arrays():</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>    <span class="co">"""Test that numpy arrays are equal"""</span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>    <span class="co"># Create two numpy arrays</span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>    array1 <span class="op">=</span> np.array([<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>])</span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>    array2 <span class="op">=</span> np.array([<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>])</span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>    <span class="co"># Check that the arrays are equal</span></span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a>    np.testing.assert_array_equal(array1, array2)</span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a><span class="co"># Note that np.testing.assert_array_equal even works with nested numpy arrays!</span></span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a><span class="kw">def</span> test_nested_numpy_arrays():</span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a>    <span class="co">"""Test that nested numpy arrays are equal"""</span></span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a>    <span class="co"># Create two nested numpy arrays</span></span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a>    array1 <span class="op">=</span> np.array([[<span class="dv">1</span>, <span class="dv">2</span>], [<span class="dv">3</span>, <span class="dv">4</span>]])</span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a>    array2 <span class="op">=</span> np.array([[<span class="dv">1</span>, <span class="dv">2</span>], [<span class="dv">3</span>, <span class="dv">4</span>]])</span>
<span id="cb4-17"><a href="#cb4-17" tabindex="-1"></a>    <span class="co"># Check that the nested arrays are equal</span></span>
<span id="cb4-18"><a href="#cb4-18" tabindex="-1"></a>    np.testing.assert_array_equal(array1, array2)</span>
<span id="cb4-19"><a href="#cb4-19" tabindex="-1"></a></span>
<span id="cb4-20"><a href="#cb4-20" tabindex="-1"></a><span class="kw">def</span> test_numpy_arrays_with_tolerance():</span>
<span id="cb4-21"><a href="#cb4-21" tabindex="-1"></a>    <span class="co">"""Test that numpy arrays are equal with tolerance"""</span></span>
<span id="cb4-22"><a href="#cb4-22" tabindex="-1"></a>    <span class="co"># Create two numpy arrays</span></span>
<span id="cb4-23"><a href="#cb4-23" tabindex="-1"></a>    array1 <span class="op">=</span> np.array([<span class="fl">1.0</span>, <span class="fl">2.0</span>, <span class="fl">3.0</span>])</span>
<span id="cb4-24"><a href="#cb4-24" tabindex="-1"></a>    array2 <span class="op">=</span> np.array([<span class="fl">1.00009</span>, <span class="fl">2.0005</span>, <span class="fl">3.0001</span>])</span>
<span id="cb4-25"><a href="#cb4-25" tabindex="-1"></a>    <span class="co"># Check that the arrays are equal with tolerance</span></span>
<span id="cb4-26"><a href="#cb4-26" tabindex="-1"></a>    np.testing.assert_allclose(array1, array2, atol<span class="op">=</span><span class="fl">1e-3</span>)</span></code></pre>
</div>
<div id="data-structures-with-numpy-arrays" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="data-structures-with-numpy-arrays" class="callout-inner">
<h3 class="callout-title">Data structures with numpy arrays<a class="anchor" aria-label="anchor" href="#data-structures-with-numpy-arrays"></a>
</h3>
<div class="callout-content">
<p>When you have data structures that contain numpy arrays, such as
lists or dictionaries, you cannot use <code>==</code> to compare them.
Instead, you can use <code>numpy.testing.assert_equal</code> to compare
the data structures.</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="kw">def</span> test_dictionaries_with_numpy_arrays():</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>    <span class="co">"""Test that dictionaries with numpy arrays are equal"""</span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>    <span class="co"># Create two dictionaries with numpy arrays</span></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>    dict1 <span class="op">=</span> {<span class="st">"a"</span>: np.array([<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>]), <span class="st">"b"</span>: np.array([<span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>])}</span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>    dict2 <span class="op">=</span> {<span class="st">"a"</span>: np.array([<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>]), <span class="st">"b"</span>: np.array([<span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>])}</span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>    <span class="co"># Check that the dictionaries are equal</span></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>    np.testing.assert_equal(dict1, dict2)</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="pandas">pandas<a class="anchor" aria-label="anchor" href="#pandas"></a>
</h3>
<p>Pandas is another common library used in research for storing and
manipulating datasets. Pandas has its own testing functions that are
more suitable for comparing pandas objects. These two functions are the
ones you are most likely to use: -
<code>pandas.testing.assert_frame_equal</code> is used to compare two
pandas DataFrames. - <code>pandas.testing.assert_series_equal</code> is
used to compare two pandas Series.</p>
<p>Here are some examples of how to use these functions:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="kw">def</span> test_pandas_dataframes():</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>    <span class="co">"""Test that pandas DataFrames are equal"""</span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>    <span class="co"># Create two pandas DataFrames</span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>    df1 <span class="op">=</span> pd.DataFrame({<span class="st">"A"</span>: [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>], <span class="st">"B"</span>: [<span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>]})</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>    df2 <span class="op">=</span> pd.DataFrame({<span class="st">"A"</span>: [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>], <span class="st">"B"</span>: [<span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>]})</span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>    <span class="co"># Check that the DataFrames are equal</span></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a>    pd.testing.assert_frame_equal(df1, df2)</span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a><span class="kw">def</span> test_pandas_series():</span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a>    <span class="co">"""Test that pandas Series are equal"""</span></span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a>    <span class="co"># Create two pandas Series</span></span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a>    s1 <span class="op">=</span> pd.Series([<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>])</span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a>    s2 <span class="op">=</span> pd.Series([<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>])</span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a>    <span class="co"># Check that the Series are equal</span></span>
<span id="cb6-16"><a href="#cb6-16" tabindex="-1"></a>    pd.testing.assert_series_equal(s1, s2)</span></code></pre>
</div>
<div id="checking-if-lists-are-equal" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="checking-if-lists-are-equal" class="callout-inner">
<h3 class="callout-title">Checking if lists are equal<a class="anchor" aria-label="anchor" href="#checking-if-lists-are-equal"></a>
</h3>
<div class="callout-content">
<p>In <code>statistics/stats.py</code> add this function to remove
anomalies from a list:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="kw">def</span> remove_anomalies(data: <span class="bu">list</span>, maximum_value: <span class="bu">float</span>, minimum_value: <span class="bu">float</span>) <span class="op">-&gt;</span> <span class="bu">list</span>:</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>    <span class="co">"""Remove anomalies from a list of numbers"""</span></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>    result <span class="op">=</span> []</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> data:</span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a>        <span class="cf">if</span> i <span class="op">&lt;=</span> maximum_value <span class="kw">and</span> i <span class="op">&gt;=</span> minimum_value:</span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a>            result.append(i)</span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a>    </span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a>    <span class="cf">return</span> result</span></code></pre>
</div>
<p>Then write a test for this function by comparing lists.</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="im">from</span> stats <span class="im">import</span> remove_anomalies</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="kw">def</span> test_remove_anomalies():</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>    <span class="co">"""Test remove_anomalies function"""</span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>    data <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">10</span>]</span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>    maximum_value <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a>    minimum_value <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a>    expected_result <span class="op">=</span> [<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>]</span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a>    <span class="cf">assert</span> remove_anomalies(data, maximum_value, minimum_value) <span class="op">==</span> expected_result</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="checking-if-dictionaries-are-equal" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="checking-if-dictionaries-are-equal" class="callout-inner">
<h3 class="callout-title">Checking if dictionaries are equal<a class="anchor" aria-label="anchor" href="#checking-if-dictionaries-are-equal"></a>
</h3>
<div class="callout-content">
<p>In <code>statistics/stats.py</code> add this function to calculate
the frequency of each element in a list:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="kw">def</span> calculate_frequency(data: <span class="bu">list</span>) <span class="op">-&gt;</span> <span class="bu">dict</span>:</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>    <span class="co">"""Calculate the frequency of each element in a list"""</span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>    frequencies <span class="op">=</span> {}</span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>    <span class="co"># Iterate over each value in the list</span></span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a>    <span class="cf">for</span> value <span class="kw">in</span> data:</span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a>        <span class="co"># If the value is already in the dictionary, increment the count</span></span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a>        <span class="cf">if</span> value <span class="kw">in</span> frequencies:</span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a>            frequencies[value] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a>        <span class="co"># Otherwise, add the value to the dictionary with a count of 1</span></span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a>            frequencies[value] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb9-14"><a href="#cb9-14" tabindex="-1"></a></span>
<span id="cb9-15"><a href="#cb9-15" tabindex="-1"></a>    <span class="cf">return</span> frequencies</span></code></pre>
</div>
<p>Then write a test for this function by comparing dictionaries.</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="im">from</span> stats <span class="im">import</span> calculate_frequency</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a><span class="kw">def</span> test_calculate_frequency():</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>    <span class="co">"""Test calculate_frequency function"""</span></span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>    data <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>]</span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a>    expected_result <span class="op">=</span> {<span class="dv">1</span>: <span class="dv">4</span>, <span class="dv">2</span>: <span class="dv">2</span>, <span class="dv">3</span>: <span class="dv">4</span>}</span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a>    <span class="cf">assert</span> calculate_frequency(data) <span class="op">==</span> expected_result</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="checking-if-numpy-arrays-are-equal" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="checking-if-numpy-arrays-are-equal" class="callout-inner">
<h3 class="callout-title">Checking if numpy arrays are equal<a class="anchor" aria-label="anchor" href="#checking-if-numpy-arrays-are-equal"></a>
</h3>
<div class="callout-content">
<p>In <code>statistics/stats.py</code> add this function to calculate
the cumulative sum of a numpy array:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a><span class="kw">def</span> calculate_cumulative_sum(array: np.ndarray) <span class="op">-&gt;</span> np.ndarray:</span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>    <span class="co">"""Calculate the cumulative sum of a numpy array"""</span></span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a>    </span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a>    <span class="co"># don't use the built-in numpy function</span></span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a>    result <span class="op">=</span> np.zeros(array.shape)</span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a>    result[<span class="dv">0</span>] <span class="op">=</span> array[<span class="dv">0</span>]</span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">len</span>(array)):</span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a>        result[i] <span class="op">=</span> result[i<span class="op">-</span><span class="dv">1</span>] <span class="op">+</span> array[i]</span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a></span>
<span id="cb11-12"><a href="#cb11-12" tabindex="-1"></a>    <span class="cf">return</span> result</span></code></pre>
</div>
<p>Then write a test for this function by comparing numpy arrays.</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> Show me the solution </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" data-bs-parent="#accordionSolution3" aria-labelledby="headingSolution3">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="im">from</span> stats <span class="im">import</span> calculate_cumulative_sum</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a><span class="kw">def</span> test_calculate_cumulative_sum():</span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>    <span class="co">"""Test calculate_cumulative_sum function"""</span></span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a>    array <span class="op">=</span> np.array([<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>])</span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a>    expected_result <span class="op">=</span> np.array([<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">10</span>, <span class="dv">15</span>])</span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a>    np.testing.assert_array_equal(calculate_cumulative_sum(array), expected_result)</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="checking-if-data-structures-with-numpy-arrays-are-equal" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="checking-if-data-structures-with-numpy-arrays-are-equal" class="callout-inner">
<h3 class="callout-title">Checking if data structures with numpy arrays are equal<a class="anchor" aria-label="anchor" href="#checking-if-data-structures-with-numpy-arrays-are-equal"></a>
</h3>
<div class="callout-content">
<p>In <code>statistics/stats.py</code> add this function to calculate
the total score of each player in a dictionary:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="kw">def</span> calculate_player_total_scores(participants: <span class="bu">dict</span>):</span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a>    <span class="co">"""Calculate the total score of each player in a dictionary.</span></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a><span class="co">    Example input:</span></span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a><span class="co">    {</span></span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a><span class="co">        "Alice": {</span></span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a><span class="co">            "scores": np.array([1, 2, 3])</span></span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a><span class="co">        },</span></span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a><span class="co">        "Bob": {</span></span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a><span class="co">            "scores": np.array([4, 5, 6])</span></span>
<span id="cb13-12"><a href="#cb13-12" tabindex="-1"></a><span class="co">        },</span></span>
<span id="cb13-13"><a href="#cb13-13" tabindex="-1"></a><span class="co">        "Charlie": {</span></span>
<span id="cb13-14"><a href="#cb13-14" tabindex="-1"></a><span class="co">            "scores": np.array([7, 8, 9])</span></span>
<span id="cb13-15"><a href="#cb13-15" tabindex="-1"></a><span class="co">        },</span></span>
<span id="cb13-16"><a href="#cb13-16" tabindex="-1"></a><span class="co">    }</span></span>
<span id="cb13-17"><a href="#cb13-17" tabindex="-1"></a></span>
<span id="cb13-18"><a href="#cb13-18" tabindex="-1"></a><span class="co">    Example output:</span></span>
<span id="cb13-19"><a href="#cb13-19" tabindex="-1"></a><span class="co">    {</span></span>
<span id="cb13-20"><a href="#cb13-20" tabindex="-1"></a><span class="co">        "Alice": {</span></span>
<span id="cb13-21"><a href="#cb13-21" tabindex="-1"></a><span class="co">            "scores": np.array([1, 2, 3]),</span></span>
<span id="cb13-22"><a href="#cb13-22" tabindex="-1"></a><span class="co">            "total_score": 6</span></span>
<span id="cb13-23"><a href="#cb13-23" tabindex="-1"></a><span class="co">        },</span></span>
<span id="cb13-24"><a href="#cb13-24" tabindex="-1"></a><span class="co">        "Bob": {</span></span>
<span id="cb13-25"><a href="#cb13-25" tabindex="-1"></a><span class="co">            "scores": np.array([4, 5, 6]),</span></span>
<span id="cb13-26"><a href="#cb13-26" tabindex="-1"></a><span class="co">            "total_score": 15</span></span>
<span id="cb13-27"><a href="#cb13-27" tabindex="-1"></a><span class="co">        },</span></span>
<span id="cb13-28"><a href="#cb13-28" tabindex="-1"></a><span class="co">        "Charlie": {</span></span>
<span id="cb13-29"><a href="#cb13-29" tabindex="-1"></a><span class="co">            "scores": np.array([7, 8, 9]),</span></span>
<span id="cb13-30"><a href="#cb13-30" tabindex="-1"></a><span class="co">            "total_score": 24</span></span>
<span id="cb13-31"><a href="#cb13-31" tabindex="-1"></a><span class="co">        },</span></span>
<span id="cb13-32"><a href="#cb13-32" tabindex="-1"></a><span class="co">    }</span></span>
<span id="cb13-33"><a href="#cb13-33" tabindex="-1"></a><span class="co">    """</span><span class="st">"</span></span>
<span id="cb13-34"><a href="#cb13-34" tabindex="-1"></a><span class="er">    </span></span>
<span id="cb13-35"><a href="#cb13-35" tabindex="-1"></a>    <span class="cf">for</span> player <span class="kw">in</span> participants:</span>
<span id="cb13-36"><a href="#cb13-36" tabindex="-1"></a>        participants[player][<span class="st">"total_score"</span>] <span class="op">=</span> np.<span class="bu">sum</span>(participants[player][<span class="st">"scores"</span>])</span>
<span id="cb13-37"><a href="#cb13-37" tabindex="-1"></a></span>
<span id="cb13-38"><a href="#cb13-38" tabindex="-1"></a>    <span class="cf">return</span> participants</span></code></pre>
</div>
<p>Then write a test for this function by comparing dictionaries with
numpy arrays.</p>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4"> Show me the solution </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" data-bs-parent="#accordionSolution4" aria-labelledby="headingSolution4">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a><span class="im">from</span> stats <span class="im">import</span> calculate_player_total_scores</span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a><span class="kw">def</span> test_calculate_player_total_scores():</span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a>    <span class="co">"""Test calculate_player_total_scores function"""</span></span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a>    participants <span class="op">=</span> {</span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a>        <span class="st">"Alice"</span>: {</span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a>            <span class="st">"scores"</span>: np.array([<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>])</span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a>        },</span>
<span id="cb14-10"><a href="#cb14-10" tabindex="-1"></a>        <span class="st">"Bob"</span>: {</span>
<span id="cb14-11"><a href="#cb14-11" tabindex="-1"></a>            <span class="st">"scores"</span>: np.array([<span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>])</span>
<span id="cb14-12"><a href="#cb14-12" tabindex="-1"></a>        },</span>
<span id="cb14-13"><a href="#cb14-13" tabindex="-1"></a>        <span class="st">"Charlie"</span>: {</span>
<span id="cb14-14"><a href="#cb14-14" tabindex="-1"></a>            <span class="st">"scores"</span>: np.array([<span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>])</span>
<span id="cb14-15"><a href="#cb14-15" tabindex="-1"></a>        },</span>
<span id="cb14-16"><a href="#cb14-16" tabindex="-1"></a>    }</span>
<span id="cb14-17"><a href="#cb14-17" tabindex="-1"></a>    expected_result <span class="op">=</span> {</span>
<span id="cb14-18"><a href="#cb14-18" tabindex="-1"></a>        <span class="st">"Alice"</span>: {</span>
<span id="cb14-19"><a href="#cb14-19" tabindex="-1"></a>            <span class="st">"scores"</span>: np.array([<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>]),</span>
<span id="cb14-20"><a href="#cb14-20" tabindex="-1"></a>            <span class="st">"total_score"</span>: <span class="dv">6</span></span>
<span id="cb14-21"><a href="#cb14-21" tabindex="-1"></a>        },</span>
<span id="cb14-22"><a href="#cb14-22" tabindex="-1"></a>        <span class="st">"Bob"</span>: {</span>
<span id="cb14-23"><a href="#cb14-23" tabindex="-1"></a>            <span class="st">"scores"</span>: np.array([<span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>]),</span>
<span id="cb14-24"><a href="#cb14-24" tabindex="-1"></a>            <span class="st">"total_score"</span>: <span class="dv">15</span></span>
<span id="cb14-25"><a href="#cb14-25" tabindex="-1"></a>        },</span>
<span id="cb14-26"><a href="#cb14-26" tabindex="-1"></a>        <span class="st">"Charlie"</span>: {</span>
<span id="cb14-27"><a href="#cb14-27" tabindex="-1"></a>            <span class="st">"scores"</span>: np.array([<span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>]),</span>
<span id="cb14-28"><a href="#cb14-28" tabindex="-1"></a>            <span class="st">"total_score"</span>: <span class="dv">24</span></span>
<span id="cb14-29"><a href="#cb14-29" tabindex="-1"></a>        },</span>
<span id="cb14-30"><a href="#cb14-30" tabindex="-1"></a>    }</span>
<span id="cb14-31"><a href="#cb14-31" tabindex="-1"></a>    np.testing.assert_equal(calculate_player_total_scores(participants), expected_result)</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="checking-if-pandas-dataframes-are-equal" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="checking-if-pandas-dataframes-are-equal" class="callout-inner">
<h3 class="callout-title">Checking if pandas DataFrames are equal<a class="anchor" aria-label="anchor" href="#checking-if-pandas-dataframes-are-equal"></a>
</h3>
<div class="callout-content">
<p>In <code>statistics/stats.py</code> add this function to calculate
the average score of each player in a pandas DataFrame:</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a><span class="kw">def</span> calculate_player_average_scores(df: pd.DataFrame) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a>    <span class="co">"""Calculate the average score of each player in a pandas DataFrame.</span></span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a><span class="co">    Example input:</span></span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a><span class="co">    |   | player  | score_1 | score_2 |</span></span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a><span class="co">    |---|---------|---------|---------|</span></span>
<span id="cb15-9"><a href="#cb15-9" tabindex="-1"></a><span class="co">    | 0 | Alice   | 1       | 2       |</span></span>
<span id="cb15-10"><a href="#cb15-10" tabindex="-1"></a><span class="co">    | 1 | Bob     | 3       | 4       |</span></span>
<span id="cb15-11"><a href="#cb15-11" tabindex="-1"></a></span>
<span id="cb15-12"><a href="#cb15-12" tabindex="-1"></a><span class="co">    Example output:</span></span>
<span id="cb15-13"><a href="#cb15-13" tabindex="-1"></a><span class="co">    |   | player  | score_1 | score_2 | average_score |</span></span>
<span id="cb15-14"><a href="#cb15-14" tabindex="-1"></a><span class="co">    |---|---------|---------|---------|---------------|</span></span>
<span id="cb15-15"><a href="#cb15-15" tabindex="-1"></a><span class="co">    | 0 | Alice   | 1       | 2       | 1.5           |</span></span>
<span id="cb15-16"><a href="#cb15-16" tabindex="-1"></a><span class="co">    | 1 | Bob     | 3       | 4       | 3.5           |</span></span>
<span id="cb15-17"><a href="#cb15-17" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb15-18"><a href="#cb15-18" tabindex="-1"></a></span>
<span id="cb15-19"><a href="#cb15-19" tabindex="-1"></a>    df[<span class="st">"average_score"</span>] <span class="op">=</span> df[[<span class="st">"score_1"</span>, <span class="st">"score_2"</span>]].mean(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb15-20"><a href="#cb15-20" tabindex="-1"></a></span>
<span id="cb15-21"><a href="#cb15-21" tabindex="-1"></a>    <span class="cf">return</span> df</span></code></pre>
</div>
<p>Then write a test for this function by comparing pandas
DataFrames.</p>
<p>Hint: You can create a dataframe like this:</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame({</span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a>    <span class="st">"player"</span>: [<span class="st">"Alice"</span>, <span class="st">"Bob"</span>],</span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a>    <span class="st">"score_1"</span>: [<span class="dv">1</span>, <span class="dv">3</span>],</span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a>    <span class="st">"score_2"</span>: [<span class="dv">2</span>, <span class="dv">4</span>]</span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a>})</span></code></pre>
</div>
</div>
</div>
</div>
<div id="accordionSolution5" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution5" aria-expanded="false" aria-controls="collapseSolution5">
  <h4 class="accordion-header" id="headingSolution5"> Show me the solution </h4>
</button>
<div id="collapseSolution5" class="accordion-collapse collapse" data-bs-parent="#accordionSolution5" aria-labelledby="headingSolution5">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a><span class="im">from</span> stats <span class="im">import</span> calculate_player_average_scores</span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a><span class="kw">def</span> test_calculate_player_average_scores():</span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a>    <span class="co">"""Test calculate_player_average_scores function"""</span></span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a>    df <span class="op">=</span> pd.DataFrame({</span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a>        <span class="st">"player"</span>: [<span class="st">"Alice"</span>, <span class="st">"Bob"</span>],</span>
<span id="cb17-8"><a href="#cb17-8" tabindex="-1"></a>        <span class="st">"score_1"</span>: [<span class="dv">1</span>, <span class="dv">3</span>],</span>
<span id="cb17-9"><a href="#cb17-9" tabindex="-1"></a>        <span class="st">"score_2"</span>: [<span class="dv">2</span>, <span class="dv">4</span>]</span>
<span id="cb17-10"><a href="#cb17-10" tabindex="-1"></a>    })</span>
<span id="cb17-11"><a href="#cb17-11" tabindex="-1"></a>    expected_result <span class="op">=</span> pd.DataFrame({</span>
<span id="cb17-12"><a href="#cb17-12" tabindex="-1"></a>        <span class="st">"player"</span>: [<span class="st">"Alice"</span>, <span class="st">"Bob"</span>],</span>
<span id="cb17-13"><a href="#cb17-13" tabindex="-1"></a>        <span class="st">"score_1"</span>: [<span class="dv">1</span>, <span class="dv">3</span>],</span>
<span id="cb17-14"><a href="#cb17-14" tabindex="-1"></a>        <span class="st">"score_2"</span>: [<span class="dv">2</span>, <span class="dv">4</span>],</span>
<span id="cb17-15"><a href="#cb17-15" tabindex="-1"></a>        <span class="st">"average_score"</span>: [<span class="fl">1.5</span>, <span class="fl">3.5</span>]</span>
<span id="cb17-16"><a href="#cb17-16" tabindex="-1"></a>    })</span>
<span id="cb17-17"><a href="#cb17-17" tabindex="-1"></a>    pd.testing.assert_frame_equal(calculate_player_average_scores(df), expected_result)</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>You can test equality of lists and dictionaries using the
<code>==</code> operator.</li>
<li>Numpy arrays cannot be compared using the <code>==</code> operator.
Instead, use <code>numpy.testing.assert_array_equal</code> and
<code>numpy.testing.assert_allclose</code>.</li>
<li>Data structures that contain numpy arrays should be compared using
<code>numpy.testing.assert_equal</code>.</li>
<li>Pandas DataFrames and Series should be compared using
<code>pandas.testing.assert_frame_equal</code> and
<code>pandas.testing.assert_series_equal</code>.</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</div>
</section></section><section id="aio-07-fixtures"><p>Content from <a href="07-fixtures.html">Fixtures</a></p>
<hr>
<p>Last updated on 2024-07-09 |

        <a href="https://github.com/SylviaWhittle/python-testing-for-research/edit/main/episodes/07-fixtures.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How to reuse data and objects in tests?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Learn how to use fixtures to store data and objects for use in
tests.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="repetitiveness-in-tests">Repetitiveness in tests<a class="anchor" aria-label="anchor" href="#repetitiveness-in-tests"></a>
<a class="anchor" aria-label="anchor" href="#repetitiveness-in-tests"></a>
</h2>
<hr class="half-width">
<p>When writing more complex tests, you may find that you need to reuse
data or objects across multiple tests.</p>
<p>Here is an example of a set of tests that re-use the same data a lot.
We have a class, <code>Point</code>, that represents a point in 2D
space. We have a few tests that check the behaviour of the class. Notice
how we have to repeat the extact same setup code in each test.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="kw">class</span> Point:</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>   <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, x, y):</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>      <span class="va">self</span>.x <span class="op">=</span> x</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>      <span class="va">self</span>.y <span class="op">=</span> y</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>   <span class="kw">def</span> distance_from_origin(<span class="va">self</span>):</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>      <span class="cf">return</span> (<span class="va">self</span>.x <span class="op">**</span> <span class="dv">2</span> <span class="op">+</span> <span class="va">self</span>.y <span class="op">**</span> <span class="dv">2</span>) <span class="op">**</span> <span class="fl">0.5</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a>   <span class="kw">def</span> move(<span class="va">self</span>, dx, dy):</span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a>      <span class="va">self</span>.x <span class="op">+=</span> dx</span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a>      <span class="va">self</span>.y <span class="op">+=</span> dy</span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a>   </span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a>   <span class="kw">def</span> reflect_over_x(<span class="va">self</span>):</span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a>      <span class="va">self</span>.y <span class="op">=</span> <span class="op">-</span><span class="va">self</span>.y</span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a>   <span class="kw">def</span> reflect_over_y(<span class="va">self</span>):</span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a>      <span class="va">self</span>.x <span class="op">=</span> <span class="op">-</span><span class="va">self</span>.x</span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="kw">def</span> test_distance_from_origin():</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>   <span class="co"># Positive coordinates</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>   point_positive_coords <span class="op">=</span> Point(<span class="dv">3</span>, <span class="dv">4</span>)</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>   <span class="co"># Negative coordinates</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>   point_negative_coords <span class="op">=</span> Point(<span class="op">-</span><span class="dv">3</span>, <span class="op">-</span><span class="dv">4</span>)</span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>   <span class="co"># Mix of positive and negative coordinates</span></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a>   point_mixed_coords <span class="op">=</span> Point(<span class="op">-</span><span class="dv">3</span>, <span class="dv">4</span>)</span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a>   <span class="cf">assert</span> point_positive_coords.distance_from_origin() <span class="op">==</span> <span class="fl">5.0</span></span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a>   <span class="cf">assert</span> point_negative_coords.distance_from_origin() <span class="op">==</span> <span class="fl">5.0</span></span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a>   <span class="cf">assert</span> point_mixed_coords.distance_from_origin() <span class="op">==</span> <span class="fl">5.0</span></span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a><span class="kw">def</span> test_move():</span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a>   <span class="co"># Repeated setup again...</span></span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a></span>
<span id="cb2-17"><a href="#cb2-17" tabindex="-1"></a>   <span class="co"># Positive coordinates</span></span>
<span id="cb2-18"><a href="#cb2-18" tabindex="-1"></a>   point_positive_coords <span class="op">=</span> Point(<span class="dv">3</span>, <span class="dv">4</span>)</span>
<span id="cb2-19"><a href="#cb2-19" tabindex="-1"></a>   <span class="co"># Negative coordinates</span></span>
<span id="cb2-20"><a href="#cb2-20" tabindex="-1"></a>   point_negative_coords <span class="op">=</span> Point(<span class="op">-</span><span class="dv">3</span>, <span class="op">-</span><span class="dv">4</span>)</span>
<span id="cb2-21"><a href="#cb2-21" tabindex="-1"></a>   <span class="co"># Mix of positive and negative coordinates</span></span>
<span id="cb2-22"><a href="#cb2-22" tabindex="-1"></a>   point_mixed_coords <span class="op">=</span> Point(<span class="op">-</span><span class="dv">3</span>, <span class="dv">4</span>)</span>
<span id="cb2-23"><a href="#cb2-23" tabindex="-1"></a></span>
<span id="cb2-24"><a href="#cb2-24" tabindex="-1"></a></span>
<span id="cb2-25"><a href="#cb2-25" tabindex="-1"></a>   <span class="co"># Test logic</span></span>
<span id="cb2-26"><a href="#cb2-26" tabindex="-1"></a>   point_positive_coords.move(<span class="dv">2</span>, <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb2-27"><a href="#cb2-27" tabindex="-1"></a>   point_negative_coords.move(<span class="dv">2</span>, <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb2-28"><a href="#cb2-28" tabindex="-1"></a>   point_mixed_coords.move(<span class="dv">2</span>, <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb2-29"><a href="#cb2-29" tabindex="-1"></a></span>
<span id="cb2-30"><a href="#cb2-30" tabindex="-1"></a>   <span class="cf">assert</span> point_positive_coords.x <span class="op">==</span> <span class="dv">5</span></span>
<span id="cb2-31"><a href="#cb2-31" tabindex="-1"></a>   <span class="cf">assert</span> point_positive_coords.y <span class="op">==</span> <span class="dv">3</span></span>
<span id="cb2-32"><a href="#cb2-32" tabindex="-1"></a>   <span class="cf">assert</span> point_negative_coords.x <span class="op">==</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb2-33"><a href="#cb2-33" tabindex="-1"></a>   <span class="cf">assert</span> point_negative_coords.y <span class="op">==</span> <span class="op">-</span><span class="dv">5</span></span>
<span id="cb2-34"><a href="#cb2-34" tabindex="-1"></a>   <span class="cf">assert</span> point_mixed_coords.x <span class="op">==</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb2-35"><a href="#cb2-35" tabindex="-1"></a>   <span class="cf">assert</span> point_mixed_coords.y <span class="op">==</span> <span class="dv">3</span></span>
<span id="cb2-36"><a href="#cb2-36" tabindex="-1"></a></span>
<span id="cb2-37"><a href="#cb2-37" tabindex="-1"></a><span class="kw">def</span> test_reflect_over_x():</span>
<span id="cb2-38"><a href="#cb2-38" tabindex="-1"></a>   <span class="co"># Yet another setup repetition</span></span>
<span id="cb2-39"><a href="#cb2-39" tabindex="-1"></a></span>
<span id="cb2-40"><a href="#cb2-40" tabindex="-1"></a>   <span class="co"># Positive coordinates</span></span>
<span id="cb2-41"><a href="#cb2-41" tabindex="-1"></a>   point_positive_coordinates <span class="op">=</span> Point(<span class="dv">3</span>, <span class="dv">4</span>)</span>
<span id="cb2-42"><a href="#cb2-42" tabindex="-1"></a>   <span class="co"># Negative coordinates</span></span>
<span id="cb2-43"><a href="#cb2-43" tabindex="-1"></a>   point_negative_coordinates <span class="op">=</span> Point(<span class="op">-</span><span class="dv">3</span>, <span class="op">-</span><span class="dv">4</span>)</span>
<span id="cb2-44"><a href="#cb2-44" tabindex="-1"></a>   <span class="co"># Mix of positive and negative coordinates</span></span>
<span id="cb2-45"><a href="#cb2-45" tabindex="-1"></a>   point_mixed_coordinates <span class="op">=</span> Point(<span class="op">-</span><span class="dv">3</span>, <span class="dv">4</span>)</span>
<span id="cb2-46"><a href="#cb2-46" tabindex="-1"></a></span>
<span id="cb2-47"><a href="#cb2-47" tabindex="-1"></a>   <span class="co"># Test logic</span></span>
<span id="cb2-48"><a href="#cb2-48" tabindex="-1"></a>   point_positive_coordinates.reflect_over_x()</span>
<span id="cb2-49"><a href="#cb2-49" tabindex="-1"></a>   point_negative_coordinates.reflect_over_x()</span>
<span id="cb2-50"><a href="#cb2-50" tabindex="-1"></a>   point_mixed_coordinates.reflect_over_x()</span>
<span id="cb2-51"><a href="#cb2-51" tabindex="-1"></a></span>
<span id="cb2-52"><a href="#cb2-52" tabindex="-1"></a>   <span class="cf">assert</span> point_positive_coordinates.x <span class="op">==</span> <span class="dv">3</span></span>
<span id="cb2-53"><a href="#cb2-53" tabindex="-1"></a>   <span class="cf">assert</span> point_positive_coordinates.y <span class="op">==</span> <span class="op">-</span><span class="dv">4</span></span>
<span id="cb2-54"><a href="#cb2-54" tabindex="-1"></a>   <span class="cf">assert</span> point_negative_coordinates.x <span class="op">==</span> <span class="op">-</span><span class="dv">3</span></span>
<span id="cb2-55"><a href="#cb2-55" tabindex="-1"></a>   <span class="cf">assert</span> point_negative_coordinates.y <span class="op">==</span> <span class="dv">4</span></span>
<span id="cb2-56"><a href="#cb2-56" tabindex="-1"></a>   <span class="cf">assert</span> point_mixed_coordinates.x <span class="op">==</span> <span class="op">-</span><span class="dv">3</span></span>
<span id="cb2-57"><a href="#cb2-57" tabindex="-1"></a>   <span class="cf">assert</span> point_mixed_coordinates.y <span class="op">==</span> <span class="op">-</span><span class="dv">4</span></span>
<span id="cb2-58"><a href="#cb2-58" tabindex="-1"></a></span>
<span id="cb2-59"><a href="#cb2-59" tabindex="-1"></a></span>
<span id="cb2-60"><a href="#cb2-60" tabindex="-1"></a><span class="kw">def</span> test_reflect_over_y():</span>
<span id="cb2-61"><a href="#cb2-61" tabindex="-1"></a>   <span class="co"># One more time...</span></span>
<span id="cb2-62"><a href="#cb2-62" tabindex="-1"></a></span>
<span id="cb2-63"><a href="#cb2-63" tabindex="-1"></a>   <span class="co"># Positive coordinates</span></span>
<span id="cb2-64"><a href="#cb2-64" tabindex="-1"></a>   point_positive_coordinates <span class="op">=</span> Point(<span class="dv">3</span>, <span class="dv">4</span>)</span>
<span id="cb2-65"><a href="#cb2-65" tabindex="-1"></a>   <span class="co"># Negative coordinates</span></span>
<span id="cb2-66"><a href="#cb2-66" tabindex="-1"></a>   point_negative_coordinates <span class="op">=</span> Point(<span class="op">-</span><span class="dv">3</span>, <span class="op">-</span><span class="dv">4</span>)</span>
<span id="cb2-67"><a href="#cb2-67" tabindex="-1"></a>   <span class="co"># Mix of positive and negative coordinates</span></span>
<span id="cb2-68"><a href="#cb2-68" tabindex="-1"></a>   point_mixed_coordinates <span class="op">=</span> Point(<span class="op">-</span><span class="dv">3</span>, <span class="dv">4</span>)</span>
<span id="cb2-69"><a href="#cb2-69" tabindex="-1"></a></span>
<span id="cb2-70"><a href="#cb2-70" tabindex="-1"></a>   <span class="co"># Test logic</span></span>
<span id="cb2-71"><a href="#cb2-71" tabindex="-1"></a>   point_positive_coordinates.reflect_over_y()</span>
<span id="cb2-72"><a href="#cb2-72" tabindex="-1"></a>   point_negative_coordinates.reflect_over_y()</span>
<span id="cb2-73"><a href="#cb2-73" tabindex="-1"></a>   point_mixed_coordinates.reflect_over_y()</span>
<span id="cb2-74"><a href="#cb2-74" tabindex="-1"></a></span>
<span id="cb2-75"><a href="#cb2-75" tabindex="-1"></a>   <span class="cf">assert</span> point_positive_coordinates.x <span class="op">==</span> <span class="op">-</span><span class="dv">3</span></span>
<span id="cb2-76"><a href="#cb2-76" tabindex="-1"></a>   <span class="cf">assert</span> point_positive_coordinates.y <span class="op">==</span> <span class="dv">4</span></span>
<span id="cb2-77"><a href="#cb2-77" tabindex="-1"></a>   <span class="cf">assert</span> point_negative_coordinates.x <span class="op">==</span> <span class="dv">3</span></span>
<span id="cb2-78"><a href="#cb2-78" tabindex="-1"></a>   <span class="cf">assert</span> point_negative_coordinates.y <span class="op">==</span> <span class="op">-</span><span class="dv">4</span></span>
<span id="cb2-79"><a href="#cb2-79" tabindex="-1"></a>   <span class="cf">assert</span> point_mixed_coordinates.x <span class="op">==</span> <span class="dv">3</span></span>
<span id="cb2-80"><a href="#cb2-80" tabindex="-1"></a>   <span class="cf">assert</span> point_mixed_coordinates.y <span class="op">==</span> <span class="dv">4</span></span></code></pre>
</div>
</section><section><h2 class="section-heading" id="fixtures">Fixtures<a class="anchor" aria-label="anchor" href="#fixtures"></a>
<a class="anchor" aria-label="anchor" href="#fixtures"></a>
</h2>
<hr class="half-width">
<p>Pytest provides a way to store data and objects for use in tests -
fixtures.</p>
<p>Fixtures are simply functions that return a value, and can be used in
tests by passing them as arguments. Pytest magically knows that any test
that requires a fixture as an argument should run the fixture function
first, and pass the result to the test.</p>
<p>Fixtures are defined using the <code>@pytest.fixture</code>
decorator. (Don’t worry if you are not aware of decorators, they are
just ways of flagging functions to do something special - in this case,
to let pytest know that this function is a fixture.)</p>
<p>Here is a very simple fixture to demonstrate this:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="im">import</span> pytest</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="at">@pytest.fixture</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="kw">def</span> my_fixture():</span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>   <span class="cf">return</span> <span class="st">"Hello, world!"</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a><span class="kw">def</span> test_my_fixture(my_fixture):</span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>   <span class="cf">assert</span> my_fixture <span class="op">==</span> <span class="st">"Hello, world!"</span></span></code></pre>
</div>
<p>Here, Pytest will notice that <code>my_fixture</code> is a fixture
due to the <code>@pytest.fixture</code> decorator, and will run
<code>my_fixture</code>, then pass the result into
<code>test_my_fixture</code>.</p>
<p>Now let’s see how we can improve the tests for the <code>Point</code>
class using fixtures:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="im">import</span> pytest</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="at">@pytest.fixture</span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a><span class="kw">def</span> point_positive_3_4():</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>   <span class="cf">return</span> Point(<span class="dv">3</span>, <span class="dv">4</span>)</span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a><span class="at">@pytest.fixture</span></span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a><span class="kw">def</span> point_negative_3_4():</span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a>   <span class="cf">return</span> Point(<span class="op">-</span><span class="dv">3</span>, <span class="op">-</span><span class="dv">4</span>)</span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a><span class="at">@pytest.fixture</span></span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a><span class="kw">def</span> point_mixed_3_4():</span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a>   <span class="cf">return</span> Point(<span class="op">-</span><span class="dv">3</span>, <span class="dv">4</span>)</span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a></span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a><span class="kw">def</span> test_distance_from_origin(point_positive_3_4, point_negative_3_4, point_mixed_3_4):</span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a>   <span class="cf">assert</span> point_positive_3_4.distance_from_origin() <span class="op">==</span> <span class="fl">5.0</span></span>
<span id="cb4-17"><a href="#cb4-17" tabindex="-1"></a>   <span class="cf">assert</span> point_negative_3_4.distance_from_origin() <span class="op">==</span> <span class="fl">5.0</span></span>
<span id="cb4-18"><a href="#cb4-18" tabindex="-1"></a>   <span class="cf">assert</span> point_mixed_3_4.distance_from_origin() <span class="op">==</span> <span class="fl">5.0</span></span>
<span id="cb4-19"><a href="#cb4-19" tabindex="-1"></a></span>
<span id="cb4-20"><a href="#cb4-20" tabindex="-1"></a><span class="kw">def</span> test_move(point_positive_3_4, point_negative_3_4, point_mixed_3_4):</span>
<span id="cb4-21"><a href="#cb4-21" tabindex="-1"></a>   point_positive_3_4.move(<span class="dv">2</span>, <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb4-22"><a href="#cb4-22" tabindex="-1"></a>   point_negative_3_4.move(<span class="dv">2</span>, <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb4-23"><a href="#cb4-23" tabindex="-1"></a>   point_mixed_3_4.move(<span class="dv">2</span>, <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb4-24"><a href="#cb4-24" tabindex="-1"></a></span>
<span id="cb4-25"><a href="#cb4-25" tabindex="-1"></a>   <span class="cf">assert</span> point_positive_3_4.x <span class="op">==</span> <span class="dv">5</span></span>
<span id="cb4-26"><a href="#cb4-26" tabindex="-1"></a>   <span class="cf">assert</span> point_positive_3_4.y <span class="op">==</span> <span class="dv">3</span></span>
<span id="cb4-27"><a href="#cb4-27" tabindex="-1"></a>   <span class="cf">assert</span> point_negative_3_4.x <span class="op">==</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb4-28"><a href="#cb4-28" tabindex="-1"></a>   <span class="cf">assert</span> point_negative_3_4.y <span class="op">==</span> <span class="op">-</span><span class="dv">5</span></span>
<span id="cb4-29"><a href="#cb4-29" tabindex="-1"></a>   <span class="cf">assert</span> point_mixed_3_4.x <span class="op">==</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb4-30"><a href="#cb4-30" tabindex="-1"></a>   <span class="cf">assert</span> point_mixed_3_4.y <span class="op">==</span> <span class="dv">3</span></span>
<span id="cb4-31"><a href="#cb4-31" tabindex="-1"></a></span>
<span id="cb4-32"><a href="#cb4-32" tabindex="-1"></a><span class="kw">def</span> test_reflect_over_x(point_positive_3_4, point_negative_3_4, point_mixed_3_4):</span>
<span id="cb4-33"><a href="#cb4-33" tabindex="-1"></a>   point_positive_3_4.reflect_over_x()</span>
<span id="cb4-34"><a href="#cb4-34" tabindex="-1"></a>   point_negative_3_4.reflect_over_x()</span>
<span id="cb4-35"><a href="#cb4-35" tabindex="-1"></a>   point_mixed_3_4.reflect_over_x()</span>
<span id="cb4-36"><a href="#cb4-36" tabindex="-1"></a></span>
<span id="cb4-37"><a href="#cb4-37" tabindex="-1"></a>   <span class="cf">assert</span> point_positive_3_4.x <span class="op">==</span> <span class="dv">3</span></span>
<span id="cb4-38"><a href="#cb4-38" tabindex="-1"></a>   <span class="cf">assert</span> point_positive_3_4.y <span class="op">==</span> <span class="op">-</span><span class="dv">4</span></span>
<span id="cb4-39"><a href="#cb4-39" tabindex="-1"></a>   <span class="cf">assert</span> point_negative_3_4.x <span class="op">==</span> <span class="op">-</span><span class="dv">3</span></span>
<span id="cb4-40"><a href="#cb4-40" tabindex="-1"></a>   <span class="cf">assert</span> point_negative_3_4.y <span class="op">==</span> <span class="dv">4</span></span>
<span id="cb4-41"><a href="#cb4-41" tabindex="-1"></a>   <span class="cf">assert</span> point_mixed_3_4.x <span class="op">==</span> <span class="op">-</span><span class="dv">3</span></span>
<span id="cb4-42"><a href="#cb4-42" tabindex="-1"></a>   <span class="cf">assert</span> point_mixed_3_4.y <span class="op">==</span> <span class="op">-</span><span class="dv">4</span></span>
<span id="cb4-43"><a href="#cb4-43" tabindex="-1"></a></span>
<span id="cb4-44"><a href="#cb4-44" tabindex="-1"></a><span class="kw">def</span> test_reflect_over_y(point_positive_3_4, point_negative_3_4, point_mixed_3_4):</span>
<span id="cb4-45"><a href="#cb4-45" tabindex="-1"></a>   point_positive_3_4.reflect_over_y()</span>
<span id="cb4-46"><a href="#cb4-46" tabindex="-1"></a>   point_negative_3_4.reflect_over_y()</span>
<span id="cb4-47"><a href="#cb4-47" tabindex="-1"></a>   point_mixed_3_4.reflect_over_y()</span>
<span id="cb4-48"><a href="#cb4-48" tabindex="-1"></a></span>
<span id="cb4-49"><a href="#cb4-49" tabindex="-1"></a>   <span class="cf">assert</span> point_positive_3_4.x <span class="op">==</span> <span class="op">-</span><span class="dv">3</span></span>
<span id="cb4-50"><a href="#cb4-50" tabindex="-1"></a>   <span class="cf">assert</span> point_positive_3_4.y <span class="op">==</span> <span class="dv">4</span></span>
<span id="cb4-51"><a href="#cb4-51" tabindex="-1"></a>   <span class="cf">assert</span> point_negative_3_4.x <span class="op">==</span> <span class="dv">3</span></span>
<span id="cb4-52"><a href="#cb4-52" tabindex="-1"></a>   <span class="cf">assert</span> point_negative_3_4.y <span class="op">==</span> <span class="op">-</span><span class="dv">4</span></span>
<span id="cb4-53"><a href="#cb4-53" tabindex="-1"></a>   <span class="cf">assert</span> point_mixed_3_4.x <span class="op">==</span> <span class="dv">3</span></span>
<span id="cb4-54"><a href="#cb4-54" tabindex="-1"></a>   <span class="cf">assert</span> point_mixed_3_4.y <span class="op">==</span> <span class="dv">4</span></span></code></pre>
</div>
<p>With the setup code defined in the fixtures, the tests are more
concise and it won’t take as much effort to add more tests in the
future.</p>
<div id="challenge-write-your-own-fixture" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-write-your-own-fixture" class="callout-inner">
<h3 class="callout-title">Challenge : Write your own fixture<a class="anchor" aria-label="anchor" href="#challenge-write-your-own-fixture"></a>
</h3>
<div class="callout-content">
<p>In the unit testing lesson, we wrote several tests for sampling &amp;
filtering data. We turned a complex function into a properly unit tested
set of functions which greatly improved the readability and
maintainability of the code, however we had to repeat the same setup
code in each test.</p>
<p>Code:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="kw">def</span> sample_participants(participants: <span class="bu">list</span>, sample_size: <span class="bu">int</span>):</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>    indexes <span class="op">=</span> random.sample(<span class="bu">range</span>(<span class="bu">len</span>(participants)), sample_size)</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>    sampled_participants <span class="op">=</span> []</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> indexes:</span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>        sampled_participants.append(participants[i])</span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>    <span class="cf">return</span> sampled_participants</span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a><span class="kw">def</span> filter_participants_by_age(participants: <span class="bu">list</span>, min_age: <span class="bu">int</span>, max_age: <span class="bu">int</span>):</span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a>    filtered_participants <span class="op">=</span> []</span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a>    <span class="cf">for</span> participant <span class="kw">in</span> participants:</span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a>        <span class="cf">if</span> participant[<span class="st">"age"</span>] <span class="op">&gt;=</span> min_age <span class="kw">and</span> participant[<span class="st">"age"</span>] <span class="op">&lt;=</span> max_age:</span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a>            filtered_participants.append(participant)</span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a>    <span class="cf">return</span> filtered_participants</span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a></span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a></span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a><span class="kw">def</span> filter_participants_by_height(participants: <span class="bu">list</span>, min_height: <span class="bu">int</span>, max_height: <span class="bu">int</span>):</span>
<span id="cb5-18"><a href="#cb5-18" tabindex="-1"></a>    filtered_participants <span class="op">=</span> []</span>
<span id="cb5-19"><a href="#cb5-19" tabindex="-1"></a>    <span class="cf">for</span> participant <span class="kw">in</span> participants:</span>
<span id="cb5-20"><a href="#cb5-20" tabindex="-1"></a>        <span class="cf">if</span> participant[<span class="st">"height"</span>] <span class="op">&gt;=</span> min_height <span class="kw">and</span> participant[<span class="st">"height"</span>] <span class="op">&lt;=</span> max_height:</span>
<span id="cb5-21"><a href="#cb5-21" tabindex="-1"></a>            filtered_participants.append(participant)</span>
<span id="cb5-22"><a href="#cb5-22" tabindex="-1"></a>    <span class="cf">return</span> filtered_participants</span>
<span id="cb5-23"><a href="#cb5-23" tabindex="-1"></a></span>
<span id="cb5-24"><a href="#cb5-24" tabindex="-1"></a></span>
<span id="cb5-25"><a href="#cb5-25" tabindex="-1"></a><span class="kw">def</span> randomly_sample_and_filter_participants(</span>
<span id="cb5-26"><a href="#cb5-26" tabindex="-1"></a>    participants: <span class="bu">list</span>, sample_size: <span class="bu">int</span>, min_age: <span class="bu">int</span>, max_age: <span class="bu">int</span>, min_height: <span class="bu">int</span>, max_height: <span class="bu">int</span></span>
<span id="cb5-27"><a href="#cb5-27" tabindex="-1"></a>):</span>
<span id="cb5-28"><a href="#cb5-28" tabindex="-1"></a>    sampled_participants <span class="op">=</span> sample_participants(participants, sample_size)</span>
<span id="cb5-29"><a href="#cb5-29" tabindex="-1"></a>    age_filtered_participants <span class="op">=</span> filter_participants_by_age(sampled_participants, min_age, max_age)</span>
<span id="cb5-30"><a href="#cb5-30" tabindex="-1"></a>    height_filtered_participants <span class="op">=</span> filter_participants_by_height(age_filtered_participants, min_height, max_height)</span>
<span id="cb5-31"><a href="#cb5-31" tabindex="-1"></a>    <span class="cf">return</span> height_filtered_participants</span></code></pre>
</div>
<p>Tests:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="im">from</span> stats <span class="im">import</span> sample_participants, filter_participants_by_age, filter_participants_by_height, randomly_sample_and_filter_participants</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a><span class="kw">def</span> test_sample_participants():</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>    <span class="co"># set random seed</span></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>    random.seed(<span class="dv">0</span>)</span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a>    participants <span class="op">=</span> [</span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a>        {<span class="st">"age"</span>: <span class="dv">25</span>, <span class="st">"height"</span>: <span class="dv">180</span>},</span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a>        {<span class="st">"age"</span>: <span class="dv">30</span>, <span class="st">"height"</span>: <span class="dv">170</span>},</span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a>        {<span class="st">"age"</span>: <span class="dv">35</span>, <span class="st">"height"</span>: <span class="dv">160</span>},</span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a>        {<span class="st">"age"</span>: <span class="dv">38</span>, <span class="st">"height"</span>: <span class="dv">165</span>},</span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a>        {<span class="st">"age"</span>: <span class="dv">40</span>, <span class="st">"height"</span>: <span class="dv">190</span>},</span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a>        {<span class="st">"age"</span>: <span class="dv">45</span>, <span class="st">"height"</span>: <span class="dv">200</span>},</span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a>    ]</span>
<span id="cb6-16"><a href="#cb6-16" tabindex="-1"></a>    sample_size <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb6-17"><a href="#cb6-17" tabindex="-1"></a>    sampled_participants <span class="op">=</span> sample_participants(participants, sample_size)</span>
<span id="cb6-18"><a href="#cb6-18" tabindex="-1"></a>    expected <span class="op">=</span> [{<span class="st">"age"</span>: <span class="dv">38</span>, <span class="st">"height"</span>: <span class="dv">165</span>}, {<span class="st">"age"</span>: <span class="dv">45</span>, <span class="st">"height"</span>: <span class="dv">200</span>}]</span>
<span id="cb6-19"><a href="#cb6-19" tabindex="-1"></a>    <span class="cf">assert</span> sampled_participants <span class="op">==</span> expected</span>
<span id="cb6-20"><a href="#cb6-20" tabindex="-1"></a></span>
<span id="cb6-21"><a href="#cb6-21" tabindex="-1"></a></span>
<span id="cb6-22"><a href="#cb6-22" tabindex="-1"></a><span class="kw">def</span> test_filter_participants_by_age():</span>
<span id="cb6-23"><a href="#cb6-23" tabindex="-1"></a>    participants <span class="op">=</span> [</span>
<span id="cb6-24"><a href="#cb6-24" tabindex="-1"></a>        {<span class="st">"age"</span>: <span class="dv">25</span>, <span class="st">"height"</span>: <span class="dv">180</span>},</span>
<span id="cb6-25"><a href="#cb6-25" tabindex="-1"></a>        {<span class="st">"age"</span>: <span class="dv">30</span>, <span class="st">"height"</span>: <span class="dv">170</span>},</span>
<span id="cb6-26"><a href="#cb6-26" tabindex="-1"></a>        {<span class="st">"age"</span>: <span class="dv">35</span>, <span class="st">"height"</span>: <span class="dv">160</span>},</span>
<span id="cb6-27"><a href="#cb6-27" tabindex="-1"></a>        {<span class="st">"age"</span>: <span class="dv">38</span>, <span class="st">"height"</span>: <span class="dv">165</span>},</span>
<span id="cb6-28"><a href="#cb6-28" tabindex="-1"></a>        {<span class="st">"age"</span>: <span class="dv">40</span>, <span class="st">"height"</span>: <span class="dv">190</span>},</span>
<span id="cb6-29"><a href="#cb6-29" tabindex="-1"></a>        {<span class="st">"age"</span>: <span class="dv">45</span>, <span class="st">"height"</span>: <span class="dv">200</span>},</span>
<span id="cb6-30"><a href="#cb6-30" tabindex="-1"></a>    ]</span>
<span id="cb6-31"><a href="#cb6-31" tabindex="-1"></a>    min_age <span class="op">=</span> <span class="dv">30</span></span>
<span id="cb6-32"><a href="#cb6-32" tabindex="-1"></a>    max_age <span class="op">=</span> <span class="dv">35</span></span>
<span id="cb6-33"><a href="#cb6-33" tabindex="-1"></a>    filtered_participants <span class="op">=</span> filter_participants_by_age(participants, min_age, max_age)</span>
<span id="cb6-34"><a href="#cb6-34" tabindex="-1"></a>    expected <span class="op">=</span> [{<span class="st">"age"</span>: <span class="dv">30</span>, <span class="st">"height"</span>: <span class="dv">170</span>}, {<span class="st">"age"</span>: <span class="dv">35</span>, <span class="st">"height"</span>: <span class="dv">160</span>}]</span>
<span id="cb6-35"><a href="#cb6-35" tabindex="-1"></a>    <span class="cf">assert</span> filtered_participants <span class="op">==</span> expected</span>
<span id="cb6-36"><a href="#cb6-36" tabindex="-1"></a></span>
<span id="cb6-37"><a href="#cb6-37" tabindex="-1"></a></span>
<span id="cb6-38"><a href="#cb6-38" tabindex="-1"></a><span class="kw">def</span> test_filter_participants_by_height():</span>
<span id="cb6-39"><a href="#cb6-39" tabindex="-1"></a>    participants <span class="op">=</span> [</span>
<span id="cb6-40"><a href="#cb6-40" tabindex="-1"></a>        {<span class="st">"age"</span>: <span class="dv">25</span>, <span class="st">"height"</span>: <span class="dv">180</span>},</span>
<span id="cb6-41"><a href="#cb6-41" tabindex="-1"></a>        {<span class="st">"age"</span>: <span class="dv">30</span>, <span class="st">"height"</span>: <span class="dv">170</span>},</span>
<span id="cb6-42"><a href="#cb6-42" tabindex="-1"></a>        {<span class="st">"age"</span>: <span class="dv">35</span>, <span class="st">"height"</span>: <span class="dv">160</span>},</span>
<span id="cb6-43"><a href="#cb6-43" tabindex="-1"></a>        {<span class="st">"age"</span>: <span class="dv">38</span>, <span class="st">"height"</span>: <span class="dv">165</span>},</span>
<span id="cb6-44"><a href="#cb6-44" tabindex="-1"></a>        {<span class="st">"age"</span>: <span class="dv">40</span>, <span class="st">"height"</span>: <span class="dv">190</span>},</span>
<span id="cb6-45"><a href="#cb6-45" tabindex="-1"></a>        {<span class="st">"age"</span>: <span class="dv">45</span>, <span class="st">"height"</span>: <span class="dv">200</span>},</span>
<span id="cb6-46"><a href="#cb6-46" tabindex="-1"></a>    ]</span>
<span id="cb6-47"><a href="#cb6-47" tabindex="-1"></a>    min_height <span class="op">=</span> <span class="dv">160</span></span>
<span id="cb6-48"><a href="#cb6-48" tabindex="-1"></a>    max_height <span class="op">=</span> <span class="dv">170</span></span>
<span id="cb6-49"><a href="#cb6-49" tabindex="-1"></a>    filtered_participants <span class="op">=</span> filter_participants_by_height(participants, min_height, max_height)</span>
<span id="cb6-50"><a href="#cb6-50" tabindex="-1"></a>    expected <span class="op">=</span> [{<span class="st">"age"</span>: <span class="dv">30</span>, <span class="st">"height"</span>: <span class="dv">170</span>}, {<span class="st">"age"</span>: <span class="dv">35</span>, <span class="st">"height"</span>: <span class="dv">160</span>}, {<span class="st">"age"</span>: <span class="dv">38</span>, <span class="st">"height"</span>: <span class="dv">165</span>}]</span>
<span id="cb6-51"><a href="#cb6-51" tabindex="-1"></a>    <span class="cf">assert</span> filtered_participants <span class="op">==</span> expected</span>
<span id="cb6-52"><a href="#cb6-52" tabindex="-1"></a></span>
<span id="cb6-53"><a href="#cb6-53" tabindex="-1"></a></span>
<span id="cb6-54"><a href="#cb6-54" tabindex="-1"></a><span class="kw">def</span> test_randomly_sample_and_filter_participants():</span>
<span id="cb6-55"><a href="#cb6-55" tabindex="-1"></a>    <span class="co"># set random seed</span></span>
<span id="cb6-56"><a href="#cb6-56" tabindex="-1"></a>    random.seed(<span class="dv">0</span>)</span>
<span id="cb6-57"><a href="#cb6-57" tabindex="-1"></a></span>
<span id="cb6-58"><a href="#cb6-58" tabindex="-1"></a>    participants <span class="op">=</span> [</span>
<span id="cb6-59"><a href="#cb6-59" tabindex="-1"></a>        {<span class="st">"age"</span>: <span class="dv">25</span>, <span class="st">"height"</span>: <span class="dv">180</span>},</span>
<span id="cb6-60"><a href="#cb6-60" tabindex="-1"></a>        {<span class="st">"age"</span>: <span class="dv">30</span>, <span class="st">"height"</span>: <span class="dv">170</span>},</span>
<span id="cb6-61"><a href="#cb6-61" tabindex="-1"></a>        {<span class="st">"age"</span>: <span class="dv">35</span>, <span class="st">"height"</span>: <span class="dv">160</span>},</span>
<span id="cb6-62"><a href="#cb6-62" tabindex="-1"></a>        {<span class="st">"age"</span>: <span class="dv">38</span>, <span class="st">"height"</span>: <span class="dv">165</span>},</span>
<span id="cb6-63"><a href="#cb6-63" tabindex="-1"></a>        {<span class="st">"age"</span>: <span class="dv">40</span>, <span class="st">"height"</span>: <span class="dv">190</span>},</span>
<span id="cb6-64"><a href="#cb6-64" tabindex="-1"></a>        {<span class="st">"age"</span>: <span class="dv">45</span>, <span class="st">"height"</span>: <span class="dv">200</span>},</span>
<span id="cb6-65"><a href="#cb6-65" tabindex="-1"></a>    ]</span>
<span id="cb6-66"><a href="#cb6-66" tabindex="-1"></a>    sample_size <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb6-67"><a href="#cb6-67" tabindex="-1"></a>    min_age <span class="op">=</span> <span class="dv">28</span></span>
<span id="cb6-68"><a href="#cb6-68" tabindex="-1"></a>    max_age <span class="op">=</span> <span class="dv">42</span></span>
<span id="cb6-69"><a href="#cb6-69" tabindex="-1"></a>    min_height <span class="op">=</span> <span class="dv">159</span></span>
<span id="cb6-70"><a href="#cb6-70" tabindex="-1"></a>    max_height <span class="op">=</span> <span class="dv">172</span></span>
<span id="cb6-71"><a href="#cb6-71" tabindex="-1"></a>    filtered_participants <span class="op">=</span> randomly_sample_and_filter_participants(</span>
<span id="cb6-72"><a href="#cb6-72" tabindex="-1"></a>        participants, sample_size, min_age, max_age, min_height, max_height</span>
<span id="cb6-73"><a href="#cb6-73" tabindex="-1"></a>    )</span>
<span id="cb6-74"><a href="#cb6-74" tabindex="-1"></a>    expected <span class="op">=</span> [{<span class="st">"age"</span>: <span class="dv">38</span>, <span class="st">"height"</span>: <span class="dv">165</span>}, {<span class="st">"age"</span>: <span class="dv">30</span>, <span class="st">"height"</span>: <span class="dv">170</span>}, {<span class="st">"age"</span>: <span class="dv">35</span>, <span class="st">"height"</span>: <span class="dv">160</span>}]</span>
<span id="cb6-75"><a href="#cb6-75" tabindex="-1"></a>    <span class="cf">assert</span> filtered_participants <span class="op">==</span> expected</span></code></pre>
</div>
<ul>
<li>Try making these tests more concise by creating a fixture for the
input data.</li>
</ul>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="im">import</span> pytest</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a><span class="at">@pytest.fixture</span></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a><span class="kw">def</span> participants():</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>    <span class="cf">return</span> [</span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>        {<span class="st">"age"</span>: <span class="dv">25</span>, <span class="st">"height"</span>: <span class="dv">180</span>},</span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a>        {<span class="st">"age"</span>: <span class="dv">30</span>, <span class="st">"height"</span>: <span class="dv">170</span>},</span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a>        {<span class="st">"age"</span>: <span class="dv">35</span>, <span class="st">"height"</span>: <span class="dv">160</span>},</span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a>        {<span class="st">"age"</span>: <span class="dv">38</span>, <span class="st">"height"</span>: <span class="dv">165</span>},</span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a>        {<span class="st">"age"</span>: <span class="dv">40</span>, <span class="st">"height"</span>: <span class="dv">190</span>},</span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a>        {<span class="st">"age"</span>: <span class="dv">45</span>, <span class="st">"height"</span>: <span class="dv">200</span>},</span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a>    ]</span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a></span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a><span class="kw">def</span> test_sample_participants(participants):</span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a>   <span class="co"># set random seed</span></span>
<span id="cb7-16"><a href="#cb7-16" tabindex="-1"></a>   random.seed(<span class="dv">0</span>)</span>
<span id="cb7-17"><a href="#cb7-17" tabindex="-1"></a></span>
<span id="cb7-18"><a href="#cb7-18" tabindex="-1"></a>   sample_size <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb7-19"><a href="#cb7-19" tabindex="-1"></a>   sampled_participants <span class="op">=</span> sample_participants(participants, sample_size)</span>
<span id="cb7-20"><a href="#cb7-20" tabindex="-1"></a>   expected <span class="op">=</span> [{<span class="st">"age"</span>: <span class="dv">38</span>, <span class="st">"height"</span>: <span class="dv">165</span>}, {<span class="st">"age"</span>: <span class="dv">45</span>, <span class="st">"height"</span>: <span class="dv">200</span>}]</span>
<span id="cb7-21"><a href="#cb7-21" tabindex="-1"></a>   <span class="cf">assert</span> sampled_participants <span class="op">==</span> expected</span>
<span id="cb7-22"><a href="#cb7-22" tabindex="-1"></a></span>
<span id="cb7-23"><a href="#cb7-23" tabindex="-1"></a><span class="kw">def</span> test_filter_participants_by_age(participants):</span>
<span id="cb7-24"><a href="#cb7-24" tabindex="-1"></a>   min_age <span class="op">=</span> <span class="dv">30</span></span>
<span id="cb7-25"><a href="#cb7-25" tabindex="-1"></a>   max_age <span class="op">=</span> <span class="dv">35</span></span>
<span id="cb7-26"><a href="#cb7-26" tabindex="-1"></a>   filtered_participants <span class="op">=</span> filter_participants_by_age(participants, min_age, max_age)</span>
<span id="cb7-27"><a href="#cb7-27" tabindex="-1"></a>   expected <span class="op">=</span> [{<span class="st">"age"</span>: <span class="dv">30</span>, <span class="st">"height"</span>: <span class="dv">170</span>}, {<span class="st">"age"</span>: <span class="dv">35</span>, <span class="st">"height"</span>: <span class="dv">160</span>}]</span>
<span id="cb7-28"><a href="#cb7-28" tabindex="-1"></a>   <span class="cf">assert</span> filtered_participants <span class="op">==</span> expected</span>
<span id="cb7-29"><a href="#cb7-29" tabindex="-1"></a></span>
<span id="cb7-30"><a href="#cb7-30" tabindex="-1"></a><span class="kw">def</span> test_filter_participants_by_height(participants):</span>
<span id="cb7-31"><a href="#cb7-31" tabindex="-1"></a>   min_height <span class="op">=</span> <span class="dv">160</span></span>
<span id="cb7-32"><a href="#cb7-32" tabindex="-1"></a>   max_height <span class="op">=</span> <span class="dv">170</span></span>
<span id="cb7-33"><a href="#cb7-33" tabindex="-1"></a>   filtered_participants <span class="op">=</span> filter_participants_by_height(participants, min_height, max_height)</span>
<span id="cb7-34"><a href="#cb7-34" tabindex="-1"></a>   expected <span class="op">=</span> [{<span class="st">"age"</span>: <span class="dv">30</span>, <span class="st">"height"</span>: <span class="dv">170</span>}, {<span class="st">"age"</span>: <span class="dv">35</span>, <span class="st">"height"</span>: <span class="dv">160</span>}, {<span class="st">"age"</span>: <span class="dv">38</span>, <span class="st">"height"</span>: <span class="dv">165</span>}]</span>
<span id="cb7-35"><a href="#cb7-35" tabindex="-1"></a>   <span class="cf">assert</span> filtered_participants <span class="op">==</span> expected</span>
<span id="cb7-36"><a href="#cb7-36" tabindex="-1"></a></span>
<span id="cb7-37"><a href="#cb7-37" tabindex="-1"></a><span class="kw">def</span> test_randomly_sample_and_filter_participants(participants):</span>
<span id="cb7-38"><a href="#cb7-38" tabindex="-1"></a>   <span class="co"># set random seed</span></span>
<span id="cb7-39"><a href="#cb7-39" tabindex="-1"></a>   random.seed(<span class="dv">0</span>)</span>
<span id="cb7-40"><a href="#cb7-40" tabindex="-1"></a></span>
<span id="cb7-41"><a href="#cb7-41" tabindex="-1"></a>   sample_size <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb7-42"><a href="#cb7-42" tabindex="-1"></a>   min_age <span class="op">=</span> <span class="dv">28</span></span>
<span id="cb7-43"><a href="#cb7-43" tabindex="-1"></a>   max_age <span class="op">=</span> <span class="dv">42</span></span>
<span id="cb7-44"><a href="#cb7-44" tabindex="-1"></a>   min_height <span class="op">=</span> <span class="dv">159</span></span>
<span id="cb7-45"><a href="#cb7-45" tabindex="-1"></a>   max_height <span class="op">=</span> <span class="dv">172</span></span>
<span id="cb7-46"><a href="#cb7-46" tabindex="-1"></a>   filtered_participants <span class="op">=</span> randomly_sample_and_filter_participants(</span>
<span id="cb7-47"><a href="#cb7-47" tabindex="-1"></a>       participants, sample_size, min_age, max_age, min_height, max_height</span>
<span id="cb7-48"><a href="#cb7-48" tabindex="-1"></a>   )</span>
<span id="cb7-49"><a href="#cb7-49" tabindex="-1"></a>   expected <span class="op">=</span> [{<span class="st">"age"</span>: <span class="dv">38</span>, <span class="st">"height"</span>: <span class="dv">165</span>}, {<span class="st">"age"</span>: <span class="dv">30</span>, <span class="st">"height"</span>: <span class="dv">170</span>}, {<span class="st">"age"</span>: <span class="dv">35</span>, <span class="st">"height"</span>: <span class="dv">160</span>}]</span>
<span id="cb7-50"><a href="#cb7-50" tabindex="-1"></a>   <span class="cf">assert</span> filtered_participants <span class="op">==</span> expected</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<p>Fixtures also allow you to set up and tear down resources that are
needed for tests, such as database connections, files, or servers, but
those are more advanced topics that we won’t cover here.</p>
<div class="section level3">
<h3 id="fixture-organisation">Fixture organisation<a class="anchor" aria-label="anchor" href="#fixture-organisation"></a>
</h3>
<p>Fixtures can be placed in the same file as the tests, or in a
separate file. If you have a lot of fixtures, it may be a good idea to
place them in a separate file to keep your test files clean. It is
common to place fixtures in a file called <code>conftest.py</code> in
the same directory as the tests.</p>
<p>For example you might have this structure:</p>
<pre><code>project_directory/
│
├── tests/
│   ├── conftest.py
│   ├── test_my_module.py
│   ├── test_my_other_module.py
│
├── my_module.py
├── my_other_module.py</code></pre>
<p>In this case, the fixtures defined in <code>conftest.py</code> can be
used in any of the test files in the <code>tests</code> directory,
provided that the fixtures are imported.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Fixtures are useful way to store data, objects and automations to
re-use them in many different tests.</li>
<li>Fixtures are defined using the <code>@pytest.fixture</code>
decorator.</li>
<li>Tests can use fixtures by passing them as arguments.</li>
<li>Fixtures can be placed in a separate file or in the same file as the
tests.</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</div>
</section></section><section id="aio-08-parametrization"><p>Content from <a href="08-parametrization.html">Parametrization</a></p>
<hr>
<p>Last updated on 2024-07-09 |

        <a href="https://github.com/SylviaWhittle/python-testing-for-research/edit/main/episodes/08-parametrization.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>Is there a better way to test a function with lots of different
inputs than writing a separate test for each one?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Understand how to use parametrization in pytest to run the same test
with different parameters in a concise and more readable way.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="parametrization">Parametrization<a class="anchor" aria-label="anchor" href="#parametrization"></a>
<a class="anchor" aria-label="anchor" href="#parametrization"></a>
</h2>
<hr class="half-width">
<p>When writing tests for functions that need to test lots of different
combinations of inputs, this can take a lot of space and be quite
verbose. Parametrization is a way to run the same test with different
parameters in a concise and more readable way.</p>
<p>To use parametrization in pytest, you need to use the
<code>@pytest.mark.parametrize</code> decorator (don’t worry if you
don’t know what this means). This decorator takes two arguments: the
name of the parameters and the list of values you want to test.</p>
<p>Consider the following example:</p>
<p>We have a Triangle class that has a function to calculate the
triangle’s area from its side lengths.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="kw">def</span> Point:</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>   <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, x, y):</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>       <span class="va">self</span>.x <span class="op">=</span> x</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>       <span class="va">self</span>.y <span class="op">=</span> y</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="kw">class</span> Triangle:</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>   <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, p1: Point, p2: Point, p3: Point):</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>      <span class="va">self</span>.p1 <span class="op">=</span> p1</span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a>      <span class="va">self</span>.p2 <span class="op">=</span> p2</span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a>      <span class="va">self</span>.p3 <span class="op">=</span> p3</span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a>   <span class="kw">def</span> calculate_area(<span class="va">self</span>):</span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a>      a <span class="op">=</span> ((<span class="va">self</span>.p1.x <span class="op">*</span> (<span class="va">self</span>.p2.y <span class="op">-</span> <span class="va">self</span>.p3.y)) <span class="op">+</span></span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a>           (<span class="va">self</span>.p2.x <span class="op">*</span> (<span class="va">self</span>.p3.y <span class="op">-</span> <span class="va">self</span>.p1.y)) <span class="op">+</span></span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a>           (<span class="va">self</span>.p3.x <span class="op">*</span> (<span class="va">self</span>.p1.y <span class="op">-</span> <span class="va">self</span>.p2.y))) <span class="op">/</span> <span class="dv">2</span></span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a>      <span class="cf">return</span> <span class="bu">abs</span>(a)</span></code></pre>
</div>
<p>If we want to test this function with different combinations of
sides, we could write a test like this:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="kw">def</span> test_calculate_area():</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>   <span class="co">"""Test the calculate_area function of the Triangle class"""</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>   <span class="co"># Equilateral triangle</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>   p11 <span class="op">=</span> Point(<span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>   p12 <span class="op">=</span> Point(<span class="dv">2</span>, <span class="dv">0</span>)</span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>   p13 <span class="op">=</span> Point(<span class="dv">1</span>, <span class="fl">1.7320</span>)</span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a>   t1 <span class="op">=</span> Triangle(p11, p12, p13)</span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a>   <span class="cf">assert</span> t1.calculate_area() <span class="op">==</span> <span class="dv">6</span></span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a>   <span class="co"># Right-angled triangle</span></span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a>   p21 <span class="op">=</span> Point(<span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a>   p22 <span class="op">=</span> Point(<span class="dv">3</span>, <span class="dv">0</span>)</span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a>   p23 <span class="op">=</span> Point(<span class="dv">0</span>, <span class="dv">4</span>)</span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a>   t2 <span class="op">=</span> Triangle(p21, p22, p23)</span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a>   <span class="cf">assert</span> t2.calculate_area() <span class="op">==</span> <span class="dv">6</span></span>
<span id="cb2-17"><a href="#cb2-17" tabindex="-1"></a></span>
<span id="cb2-18"><a href="#cb2-18" tabindex="-1"></a>   <span class="co"># Isosceles triangle</span></span>
<span id="cb2-19"><a href="#cb2-19" tabindex="-1"></a>   p31 <span class="op">=</span> Point(<span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb2-20"><a href="#cb2-20" tabindex="-1"></a>   p32 <span class="op">=</span> Point(<span class="dv">4</span>, <span class="dv">0</span>)</span>
<span id="cb2-21"><a href="#cb2-21" tabindex="-1"></a>   p33 <span class="op">=</span> Point(<span class="dv">2</span>, <span class="dv">8</span>)</span>
<span id="cb2-22"><a href="#cb2-22" tabindex="-1"></a>   t3 <span class="op">=</span> Triangle(p31, p32, p33)</span>
<span id="cb2-23"><a href="#cb2-23" tabindex="-1"></a>   <span class="cf">assert</span> t3.calculate_area() <span class="op">==</span> <span class="dv">16</span></span>
<span id="cb2-24"><a href="#cb2-24" tabindex="-1"></a></span>
<span id="cb2-25"><a href="#cb2-25" tabindex="-1"></a>   <span class="co"># Scalene triangle</span></span>
<span id="cb2-26"><a href="#cb2-26" tabindex="-1"></a>   p41 <span class="op">=</span> Point(<span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb2-27"><a href="#cb2-27" tabindex="-1"></a>   p42 <span class="op">=</span> Point(<span class="dv">3</span>, <span class="dv">0</span>)</span>
<span id="cb2-28"><a href="#cb2-28" tabindex="-1"></a>   p43 <span class="op">=</span> Point(<span class="dv">1</span>, <span class="dv">4</span>)</span>
<span id="cb2-29"><a href="#cb2-29" tabindex="-1"></a>   t4 <span class="op">=</span> Triangle(p41, p42, p43)</span>
<span id="cb2-30"><a href="#cb2-30" tabindex="-1"></a>   <span class="cf">assert</span> t4.calculate_area() <span class="op">==</span> <span class="dv">6</span></span>
<span id="cb2-31"><a href="#cb2-31" tabindex="-1"></a></span>
<span id="cb2-32"><a href="#cb2-32" tabindex="-1"></a>   <span class="co"># Negative values</span></span>
<span id="cb2-33"><a href="#cb2-33" tabindex="-1"></a>   p51 <span class="op">=</span> Point(<span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb2-34"><a href="#cb2-34" tabindex="-1"></a>   p52 <span class="op">=</span> Point(<span class="op">-</span><span class="dv">3</span>, <span class="dv">0</span>)</span>
<span id="cb2-35"><a href="#cb2-35" tabindex="-1"></a>   p53 <span class="op">=</span> Point(<span class="dv">0</span>, <span class="op">-</span><span class="dv">4</span>)</span>
<span id="cb2-36"><a href="#cb2-36" tabindex="-1"></a>   t5 <span class="op">=</span> Triangle(p51, p52, p53)</span>
<span id="cb2-37"><a href="#cb2-37" tabindex="-1"></a>   <span class="cf">assert</span> t5.calculate_area() <span class="op">==</span> <span class="dv">6</span></span></code></pre>
</div>
<p>This test is quite long and repetitive. We can use parametrization to
make it more concise:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="im">import</span> pytest</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="at">@pytest.mark.parametrize</span>(</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>   (<span class="st">"p1x, p1y, p2x, p2y, p3x, p3y, expected"</span>),</span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>   [</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>      pytest.param(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">1.7320</span>, <span class="dv">6</span>, <span class="bu">id</span><span class="op">=</span><span class="st">"Equilateral triangle"</span>),</span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>      pytest.param(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">4</span>, <span class="dv">6</span>, <span class="bu">id</span><span class="op">=</span><span class="st">"Right-angled triangle"</span>),</span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>      pytest.param(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">4</span>, <span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">8</span>, <span class="dv">16</span>, <span class="bu">id</span><span class="op">=</span><span class="st">"Isosceles triangle"</span>),</span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>      pytest.param(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">6</span>, <span class="bu">id</span><span class="op">=</span><span class="st">"Scalene triangle"</span>),</span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a>      pytest.param(<span class="dv">0</span>, <span class="dv">0</span>, <span class="op">-</span><span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="op">-</span><span class="dv">4</span>, <span class="dv">6</span>, <span class="bu">id</span><span class="op">=</span><span class="st">"Negative values"</span>)</span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a>   ]</span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a>)</span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a><span class="kw">def</span> test_calculate_area(p1x, p1y, p2x, p2y, p3x, p3y, expected):</span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a>   p1 <span class="op">=</span> Point(p1x, p1y)</span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a>   p2 <span class="op">=</span> Point(p2x, p2y)</span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a>   p3 <span class="op">=</span> Point(p3x, p3y)</span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a>   t <span class="op">=</span> Triangle(p1, p2, p3)</span>
<span id="cb3-18"><a href="#cb3-18" tabindex="-1"></a>   <span class="cf">assert</span> t.calculate_area() <span class="op">==</span> expected</span></code></pre>
</div>
<p>Let’s have a look at how this works.</p>
<p>Similar to how fixtures are defined, the
<code>@pytest.mark.parametrize</code> line is a decorator, letting
pytest know that this is a parametrized test.</p>
<ul>
<li><p>The first argument is a tuple, a list of the names of the
parameters you want to use in your test. For example
<code>("p1x, p2y, p2x, p2y, p3x, p3y, expected")</code> means that we
will use the parameters <code>p1x</code>, <code>p1y</code>,
<code>p2x</code>, <code>p2y</code>, <code>p3x</code>, <code>p3y</code>
and <code>expected</code> in our test.</p></li>
<li><p>The second argument is a list of <code>pytest.param</code>
objects. Each <code>pytest.param</code> object is a tuple of the values
you want to test, with an optional <code>id</code> argument to give a
name to the test. For example,
<code>pytest.param(0, 0, 2, 0, 1, 1.7320, 6, id="Equilateral triangle")</code>
means that we will test the function with the parameters
<code>0, 0, 2, 0, 1, 1.7320, 6</code> and give it the name “Equilateral
triangle”.</p></li>
</ul>
<p>(note that if the test fails you will see the id in the output, so
it’s useful to give them meaningful names to help you understand what
went wrong.)</p>
<ul>
<li><p>The test function will be run once for each set of parameters in
the list.</p></li>
<li><p>Inside the test function, you can use the parameters as you would
any other variable.</p></li>
</ul>
<p>This is a much more concise way to write tests for functions that
need to be tested with lots of different inputs, especially when there
is a lot of repetition in the setup for each of the different test
cases.</p>
<div id="challenge---practice-with-parametrization" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge---practice-with-parametrization" class="callout-inner">
<h3 class="callout-title">Challenge - Practice with Parametrization<a class="anchor" aria-label="anchor" href="#challenge---practice-with-parametrization"></a>
</h3>
<div class="callout-content">
<p>Add the following function to
<code>advanced/advanced_calculator.py</code> and write a parametrized
test for it in <code>tests/test_advanced_calculator.py</code> that tests
the function with a range of different inputs using parametrization.</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="kw">def</span> is_prime(n: <span class="bu">int</span>) <span class="op">-&gt;</span> <span class="bu">bool</span>:</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>    <span class="co">"""Return True if n is a prime number, False otherwise"""</span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>    <span class="cf">if</span> n <span class="op">&lt;</span> <span class="dv">2</span>:</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">2</span>, <span class="bu">int</span>(n <span class="op">**</span> <span class="fl">0.5</span>) <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>        <span class="cf">if</span> n <span class="op">%</span> i <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">True</span></span></code></pre>
</div>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="im">import</span> pytest</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="at">@pytest.mark.parametrize</span>(</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>   (<span class="st">"n, expected"</span>),</span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>   [</span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>      pytest.param(<span class="dv">0</span>, <span class="va">False</span>, <span class="bu">id</span><span class="op">=</span><span class="st">"0 is not prime"</span>),</span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>      pytest.param(<span class="dv">1</span>, <span class="va">False</span>, <span class="bu">id</span><span class="op">=</span><span class="st">"1 is not prime"</span>),</span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a>      pytest.param(<span class="dv">2</span>, <span class="va">True</span>, <span class="bu">id</span><span class="op">=</span><span class="st">"2 is prime"</span>),</span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a>      pytest.param(<span class="dv">3</span>, <span class="va">True</span>, <span class="bu">id</span><span class="op">=</span><span class="st">"3 is prime"</span>),</span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a>      pytest.param(<span class="dv">4</span>, <span class="va">False</span>, <span class="bu">id</span><span class="op">=</span><span class="st">"4 is not prime"</span>),</span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a>      pytest.param(<span class="dv">5</span>, <span class="va">True</span>, <span class="bu">id</span><span class="op">=</span><span class="st">"5 is prime"</span>),</span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a>      pytest.param(<span class="dv">6</span>, <span class="va">False</span>, <span class="bu">id</span><span class="op">=</span><span class="st">"6 is not prime"</span>),</span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a>      pytest.param(<span class="dv">7</span>, <span class="va">True</span>, <span class="bu">id</span><span class="op">=</span><span class="st">"7 is prime"</span>),</span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a>      pytest.param(<span class="dv">8</span>, <span class="va">False</span>, <span class="bu">id</span><span class="op">=</span><span class="st">"8 is not prime"</span>),</span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a>      pytest.param(<span class="dv">9</span>, <span class="va">False</span>, <span class="bu">id</span><span class="op">=</span><span class="st">"9 is not prime"</span>),</span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a>      pytest.param(<span class="dv">10</span>, <span class="va">False</span>, <span class="bu">id</span><span class="op">=</span><span class="st">"10 is not prime"</span>),</span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a>      pytest.param(<span class="dv">11</span>, <span class="va">True</span>, <span class="bu">id</span><span class="op">=</span><span class="st">"11 is prime"</span>),</span>
<span id="cb5-18"><a href="#cb5-18" tabindex="-1"></a>      pytest.param(<span class="dv">12</span>, <span class="va">False</span>, <span class="bu">id</span><span class="op">=</span><span class="st">"12 is not prime"</span>),</span>
<span id="cb5-19"><a href="#cb5-19" tabindex="-1"></a>      pytest.param(<span class="dv">13</span>, <span class="va">True</span>, <span class="bu">id</span><span class="op">=</span><span class="st">"13 is prime"</span>),</span>
<span id="cb5-20"><a href="#cb5-20" tabindex="-1"></a>      pytest.param(<span class="dv">14</span>, <span class="va">False</span>, <span class="bu">id</span><span class="op">=</span><span class="st">"14 is not prime"</span>),</span>
<span id="cb5-21"><a href="#cb5-21" tabindex="-1"></a>      pytest.param(<span class="dv">15</span>, <span class="va">False</span>, <span class="bu">id</span><span class="op">=</span><span class="st">"15 is not prime"</span>),</span>
<span id="cb5-22"><a href="#cb5-22" tabindex="-1"></a>      pytest.param(<span class="dv">16</span>, <span class="va">False</span>, <span class="bu">id</span><span class="op">=</span><span class="st">"16 is not prime"</span>),</span>
<span id="cb5-23"><a href="#cb5-23" tabindex="-1"></a>      pytest.param(<span class="dv">17</span>, <span class="va">True</span>, <span class="bu">id</span><span class="op">=</span><span class="st">"17 is prime"</span>),</span>
<span id="cb5-24"><a href="#cb5-24" tabindex="-1"></a>      pytest.param(<span class="dv">18</span>, <span class="va">False</span>, <span class="bu">id</span><span class="op">=</span><span class="st">"18 is not prime"</span>),</span>
<span id="cb5-25"><a href="#cb5-25" tabindex="-1"></a>      pytest.param(<span class="dv">19</span>, <span class="va">True</span>, <span class="bu">id</span><span class="op">=</span><span class="st">"19 is prime"</span>),</span>
<span id="cb5-26"><a href="#cb5-26" tabindex="-1"></a>      pytest.param(<span class="dv">20</span>, <span class="va">False</span>, <span class="bu">id</span><span class="op">=</span><span class="st">"20 is not prime"</span>),</span>
<span id="cb5-27"><a href="#cb5-27" tabindex="-1"></a>      pytest.param(<span class="dv">21</span>, <span class="va">False</span>, <span class="bu">id</span><span class="op">=</span><span class="st">"21 is not prime"</span>),</span>
<span id="cb5-28"><a href="#cb5-28" tabindex="-1"></a>      pytest.param(<span class="dv">22</span>, <span class="va">False</span>, <span class="bu">id</span><span class="op">=</span><span class="st">"22 is not prime"</span>),</span>
<span id="cb5-29"><a href="#cb5-29" tabindex="-1"></a>      pytest.param(<span class="dv">23</span>, <span class="va">True</span>, <span class="bu">id</span><span class="op">=</span><span class="st">"23 is prime"</span>),</span>
<span id="cb5-30"><a href="#cb5-30" tabindex="-1"></a>      pytest.param(<span class="dv">24</span>, <span class="va">False</span>, <span class="bu">id</span><span class="op">=</span><span class="st">"24 is not prime"</span>),</span>
<span id="cb5-31"><a href="#cb5-31" tabindex="-1"></a>   ]</span>
<span id="cb5-32"><a href="#cb5-32" tabindex="-1"></a>)</span>
<span id="cb5-33"><a href="#cb5-33" tabindex="-1"></a><span class="kw">def</span> test_is_prime(n, expected):</span>
<span id="cb5-34"><a href="#cb5-34" tabindex="-1"></a>   <span class="cf">assert</span> is_prime(n) <span class="op">==</span> expected</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Parametrization is a way to run the same test with different
parameters in a concise and more readable way, especially when there is
a lot of repetition in the setup for each of the different test
cases.</li>
<li>Use the <code>@pytest.mark.parametrize</code> decorator to define a
parametrized test.</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-09-testing-output-files"><p>Content from <a href="09-testing-output-files.html">Regression Testing and Plots</a></p>
<hr>
<p>Last updated on 2024-07-09 |

        <a href="https://github.com/SylviaWhittle/python-testing-for-research/edit/main/episodes/09-testing-output-files.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How to test for changes in program outputs?</li>
<li>How to test for changes in plots?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Learn how to test for changes in images &amp; plots</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="regression-testing">Regression testing<a class="anchor" aria-label="anchor" href="#regression-testing"></a>
<a class="anchor" aria-label="anchor" href="#regression-testing"></a>
</h2>
<hr class="half-width">
<p>When you have a large processing pipeline or you are just starting
out adding tests to an existing project, you might not have the time to
carefully define exactly what each function should do, or your code may
be so complex that it’s hard to write unit tests for it all.</p>
<p>In these cases, you can use regression testing. This is where you
just test that the output of a function matches the output of a previous
version of the function.</p>
<p>The library <code>pytest-regtest</code> provides a simple way to do
this. When writing a test, we pass the argument <code>regtest</code> to
the test function and use <code>regtest.write()</code> to log the output
of the function. This tells pytest-regtest to compare the output of the
test to the output of the previous test run.</p>
<p>To install <code>pytest-regtest</code>:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="ex">pip</span> install pytest-regtest</span></code></pre>
</div>
<div id="callout1" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout<a class="anchor" aria-label="anchor" href="#callout1"></a>
</h3>
<div class="callout-content">
<p>This <code>regtest</code> argument is actually a fixture that is
provided by the <code>pytest-regtest</code> package. It captures the
output of the test function and compares it to the output of the
previous test run. If the output is different, the test will fail.</p>
</div>
</div>
</div>
<p>Let’s make a regression test:</p>
<ul>
<li>Create a new function in <code>statistics/stats.py</code> called
<code>very_complex_processing()</code>:</li>
</ul>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="kw">def</span> very_complex_processing(data: <span class="bu">list</span>):</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>    <span class="co"># Do some very complex processing</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>    processed_data <span class="op">=</span> [x <span class="op">*</span> <span class="dv">2</span> <span class="cf">for</span> x <span class="kw">in</span> data]</span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>    <span class="cf">return</span> processed_data</span></code></pre>
</div>
<ul>
<li>Then in <code>test_stats.py</code>, we can add a regression test for
this function using the <code>regtest</code> argument.</li>
</ul>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="im">import</span> pytest</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="im">from</span> stats <span class="im">import</span> very_complex_processing</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a><span class="kw">def</span> test_very_complex_processing(regtest):</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>    data <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>]</span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>    processed_data <span class="op">=</span> very_complex_processing(data)</span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a>    regtest.write(<span class="bu">str</span>(processed_data))</span></code></pre>
</div>
<ul>
<li>Now because we haven’t run the test yet, there is no reference
output to compare against, so we need to generate it using the
<code>--regtest-generate</code> flag:</li>
</ul>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="ex">pytest</span> <span class="at">--regtest-generate</span></span></code></pre>
</div>
<p>This tells pytest to run the test but instead of comparing the
result, it will save the result for use in future tests.</p>
<ul>
<li><p>Try running pytest and since we haven’t changed how the function
works, the test should pass.</p></li>
<li><p>Then change the function to break the test and re-run pytest. The
test will fail and show you the difference between the expected and
actual output.</p></li>
</ul>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="ex">===</span> FAILURES ===</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="ex">___</span> test_very_complex_processing ___</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a><span class="ex">regression</span> test output differences for statistics/test_stats.py::test_very_complex_processing:</span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a><span class="kw">(</span><span class="ex">recorded</span> output from statistics/_regtest_outputs/test_stats.test_very_complex_processing.out<span class="kw">)</span></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a><span class="op">&gt;</span>   --- <span class="ex">current</span></span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a><span class="op">&gt;</span>   +++ <span class="ex">expected</span></span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a><span class="op">&gt;</span>   @@ <span class="ex">-1</span> +1 @@</span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a><span class="op">&gt;</span>   -[3, <span class="ex">6,</span> 9]</span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a><span class="op">&gt;</span>   +[2, <span class="ex">4,</span> 6]</span></code></pre>
</div>
<p>Here we can see that it has picked up on the difference between the
expected and actual output, and displayed it for us to see.</p>
<p>Regression tests, while not as powerful as unit tests, are a great
way to quickly add tests to a project and ensure that changes to the
code don’t break existing functionality. It is also a good idea to add
regression tests to your main processing pipelines just in case your
unit tests don’t cover all the edge cases, this will ensure that the
output of your program remains consistent between versions.</p>
</section><section><h2 class="section-heading" id="testing-plots">Testing plots<a class="anchor" aria-label="anchor" href="#testing-plots"></a>
<a class="anchor" aria-label="anchor" href="#testing-plots"></a>
</h2>
<hr class="half-width">
<p>When you are working with plots, you may want to test that the output
is as expected. This can be done by comparing the output to a reference
image or plot. The <code>pytest-mpl</code> package provides a simple way
to do this, automating the comparison of the output of a test function
to a reference image.</p>
<p>To install <code>pytest-mpl</code>:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="ex">pip</span> install pytest-mpl</span></code></pre>
</div>
<ul>
<li>Create a new folder called <code>plotting</code> and add a file
<code>plotting.py</code> with the following function:</li>
</ul>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a><span class="kw">def</span> plot_data(data: <span class="bu">list</span>):</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>    ax.plot(data)</span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>    <span class="cf">return</span> fig</span></code></pre>
</div>
<p>This function takes a list of points to plot, plots them and returns
the figure produced.</p>
<p>In order to test that this funciton produces the correct plots, we
will need to store the correct plots to compare against. - Create a new
folder called <code>test_plots</code> inside the <code>plotting</code>
folder. This is where we will store the reference images.</p>
<p><code>pytest-mpl</code> adds the
<code>@pytest.mark.mpl_image_compare</code> decorator that is used to
compare the output of a test function to a reference image. It takes a
<code>baseline_dir</code> argument that specifies the directory where
the reference images are stored.</p>
<ul>
<li>Create a new file called <code>test_plotting.py</code> in the
<code>plotting</code> folder with the following content:</li>
</ul>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="im">import</span> pytest</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="im">from</span> plotting <span class="im">import</span> plot_data</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="at">@pytest.mark.mpl_image_compare</span>(baseline_dir<span class="op">=</span><span class="st">"test_plots/"</span>)</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="kw">def</span> test_plot_data():</span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>    data <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">2</span>]</span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a>    fig <span class="op">=</span> plot_data(data)</span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a>    <span class="cf">return</span> fig</span></code></pre>
</div>
<p>Here we have told pytest that we want it to compare the output of the
<code>test_plot_data</code> function to the images in the
<code>test_plots</code> directory.</p>
<ul>
<li>Run the following command to generate the reference image: (make
sure you are in the base directory in your project and not in the
plotting folder)</li>
</ul>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="ex">pytest</span> <span class="at">--mpl-generate-path</span><span class="op">=</span>plotitng/test_plots</span></code></pre>
</div>
<p>This tells pytest to run the test but instead of comparing the
result, it will save the result into the <code>test_plots</code>
directory for use in future tests.</p>
<p>Now we have the reference image, we can run the test to ensure that
the output of <code>plot_data</code> matches the reference image. Pytest
doesn’t check the images by default, so we need to pass it the
<code>--mpl</code> flag to tell it to check the images.</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="ex">pytest</span> <span class="at">--mpl</span></span></code></pre>
</div>
<p>Since we just generated the reference image, the test should
pass.</p>
<p>Now let’s edit the <code>plot_data</code> function to plot a
different set of points by adding a 4 to the data:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a><span class="kw">def</span> plot_data(data: <span class="bu">list</span>):</span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a>    <span class="co"># Add 4 to the data</span></span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a>    data.append(<span class="dv">4</span>)</span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a>    ax.plot(data)</span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a>    <span class="cf">return</span> fig</span></code></pre>
</div>
<ul>
<li>Now re-run the test. You should see that it fails.</li>
</ul>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="ex">===</span> FAILURES ===</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="ex">___</span> test_plot_data ___</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a><span class="ex">Error:</span> Image files did not match.</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>  <span class="ex">RMS</span> Value: 15.740441786649093</span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>  <span class="ex">Expected:</span>  </span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a>    <span class="ex">/var/folders/sr/wjtfqr9s6x3bw1s647t649x80000gn/T/tmp6d0p4yvm/test_plotting.test_plot_data/baseline.png</span></span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a>  <span class="ex">Actual:</span>    </span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a>    <span class="ex">/var/folders/sr/wjtfqr9s6x3bw1s647t649x80000gn/T/tmp6d0p4yvm/test_plotting.test_plot_data/result.png</span></span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a>  <span class="ex">Difference:</span></span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a>    <span class="ex">/var/folders/sr/wjtfqr9s6x3bw1s647t649x80000gn/T/tmp6d0p4yvm/test_plotting.test_plot_data/result-failed-diff.png</span></span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a>  <span class="ex">Tolerance:</span> </span>
<span id="cb12-12"><a href="#cb12-12" tabindex="-1"></a>    <span class="ex">2</span></span></code></pre>
</div>
<p>Notice that the test shows you three image files. (All of these files
are stored in a temporary directory that pytest creates when running the
test. Depending on your system, you may be able to click on the paths to
view the images. Try holding down CTRL or Command and clicking on the
path.)</p>
<ul>
<li>The first, “Expected” is the reference image that the test is
comparing against.</li>
<li>The second, “Actual” is the image that was produced by the
test.</li>
<li>And the third is a difference image that shows the differences
between the two images. This is very useful as it enables us to cleraly
see what went wrong with the plotting, allowing us to fix the issue more
easily. In this example, we can clearly see that the axes ticks are
different, and the line plot is a completely different shape.</li>
</ul>
<p>This doesn’t just work with line plots, but with any type of plot
that matplotlib can produce.</p>
<p>Testing your plots can be very useful especially if your project
allows users to define their own plots.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Regression testing ensures that the output of a function remains
consistent between changes and are a great first step in adding tests to
an existing project.</li>
<li>
<code>pytest-regtest</code> provides a simple way to do regression
testing.</li>
<li>
<code>pytest-mpl</code> provides a simple way to test plots by
comparing the output of a test function to a reference image.</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-10-CI"><p>Content from <a href="10-CI.html">Continuous Integration with GitHub Actions</a></p>
<hr>
<p>Last updated on 2024-07-09 |

        <a href="https://github.com/SylviaWhittle/python-testing-for-research/edit/main/episodes/10-CI.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I automate the testing of my code?</li>
<li>What are GitHub Actions?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Understand the concept of continuous integration</li>
<li>Learn how to use GitHub Actions to automate the testing of your
code</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="continuous-integration">Continuous Integration<a class="anchor" aria-label="anchor" href="#continuous-integration"></a>
<a class="anchor" aria-label="anchor" href="#continuous-integration"></a>
</h2>
<hr class="half-width">
<p>Continuous Integration (CI) is the practice of automating the merging
of code changes into a project. In the context of software testing, CI
is the practice of running tests on every code change to ensure that the
code is working as expected. GitHub provides a feature called GitHub
Actions that allows you to integrate this into your projects.</p>
<p>In this lesson we will go over the very basics of how to set up a
GitHub Action to run tests on your code.</p>
</section><section><h2 class="section-heading" id="setting-up-your-project-repository">Setting up your project repository<a class="anchor" aria-label="anchor" href="#setting-up-your-project-repository"></a>
<a class="anchor" aria-label="anchor" href="#setting-up-your-project-repository"></a>
</h2>
<hr class="half-width">
<ul>
<li>Create a new repository on GitHub for this lesson called
“python-testing-course” (whatever you like really)</li>
<li>Clone the repository into your local machine using
<code>git clone &lt;repository-url&gt;</code> or GitKraken if you use
that.</li>
<li>Move over all your code from the previous lessons into this
repository.</li>
<li>Commit the changes using <code>git add .</code> and
<code>git commit -m "Add all the project code"</code>
</li>
<li>Create a new file called <code>requirements.txt</code> in the root
of your repository and add the following contents:</li>
</ul>
<pre><code><span><span class="va">pytest</span></span>
<span><span class="va">numpy</span></span>
<span><span class="va">pandas</span></span>
<span><span class="va">pytest</span><span class="op">-</span><span class="va">mpl</span></span>
<span><span class="va">pytest</span><span class="op">-</span><span class="va">regtest</span></span>
<span><span class="va">matplotlib</span></span></code></pre>
<p>This is just a list of all the packages that your project uses and
will be needed later. Recall that each of these are used in various
lessons in this course.</p>
<p>Now we have a repository with all our code in it online on
GitHub.</p>
</section><section><h2 class="section-heading" id="creating-a-github-action">Creating a GitHub Action<a class="anchor" aria-label="anchor" href="#creating-a-github-action"></a>
<a class="anchor" aria-label="anchor" href="#creating-a-github-action"></a>
</h2>
<hr class="half-width">
<p>GitHub Actions are defined in <code>yaml</code> files (these are just
simple text files that contain a list of instructions). They are stored
in the <code>.github/workflows</code> directory in your repository.</p>
<ul>
<li>Create a new directory in your repository called
<code>.github</code>
</li>
<li>Inside the <code>.github</code> directory, create a new directory
called <code>workflows</code>
</li>
<li>Inside the <code>workflows</code> directory, create a new file
called <code>tests.yaml</code>
</li>
</ul>
<p>This <code>test.yaml</code> file is where you will tell GitHub how to
run the tests for your code.</p>
<p>Let’s add some instructions to the <code>tests.yaml</code> file:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">YAML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode yaml" tabindex="0"><code class="sourceCode yaml"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="co"># This is just the name of the action, you can call it whatever you like.</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="fu">name</span><span class="kw">:</span><span class="at"> Tests (pytest)</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="co"># This is the event that triggers the action. In this case, we are telling GitHub to run the tests whenever a pull request is made to the main branch.</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a><span class="fu">on</span><span class="kw">:</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a><span class="at">    </span><span class="fu">pull_request</span><span class="kw">:</span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a><span class="at">        </span><span class="fu">branches</span><span class="kw">:</span></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a><span class="at">            </span><span class="kw">-</span><span class="at"> main</span></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a><span class="co"># This is a list of jobs that the action will run. In this case, we have only one job called build.</span></span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a><span class="fu">jobs</span><span class="kw">:</span></span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a><span class="at">    </span><span class="fu">build</span><span class="kw">:</span></span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a><span class="co">        # This is the environment that the job will run on. In this case, we are using the latest version of Ubuntu, however you can ues other operating systems like Windows or MacOS if you like!</span></span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a><span class="at">        </span><span class="fu">runs-on</span><span class="kw">:</span><span class="at"> ubuntu-latest</span></span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a></span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a><span class="co">        # This is a list of steps that the job will run. Each step is a command that will be executed on the environment.</span></span>
<span id="cb2-17"><a href="#cb2-17" tabindex="-1"></a><span class="at">        </span><span class="fu">steps</span><span class="kw">:</span></span>
<span id="cb2-18"><a href="#cb2-18" tabindex="-1"></a><span class="co">            # This command tells GitHub to use a pre-built action. In this case, we are using the actions/checkout action to check out the repository. This just means that GitHub will use this repository's code to run the tests.</span></span>
<span id="cb2-19"><a href="#cb2-19" tabindex="-1"></a><span class="at">            </span><span class="kw">-</span><span class="at"> </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> actions/checkout@v3</span><span class="co"> # Check out the repository on github</span></span>
<span id="cb2-20"><a href="#cb2-20" tabindex="-1"></a><span class="co">            # This is the name of the step. This is just a label that will be displayed in the GitHub UI.</span></span>
<span id="cb2-21"><a href="#cb2-21" tabindex="-1"></a><span class="at">            </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Set up Python 3.10</span></span>
<span id="cb2-22"><a href="#cb2-22" tabindex="-1"></a><span class="co">              # This command tells GitHub to use a pre-built action. In this case, we are using the actions/setup-python action to set up Python 3.10.</span></span>
<span id="cb2-23"><a href="#cb2-23" tabindex="-1"></a><span class="at">              </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> actions/setup-python@v3</span></span>
<span id="cb2-24"><a href="#cb2-24" tabindex="-1"></a><span class="at">              </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb2-25"><a href="#cb2-25" tabindex="-1"></a><span class="at">                  </span><span class="fu">python-version</span><span class="kw">:</span><span class="at"> </span><span class="st">"3.10"</span></span>
<span id="cb2-26"><a href="#cb2-26" tabindex="-1"></a><span class="at">            </span></span>
<span id="cb2-27"><a href="#cb2-27" tabindex="-1"></a><span class="co">            # This step installs the dependencies for the project such as pytest, numpy, pandas, etc using the requirements.txt file we created earlier.</span></span>
<span id="cb2-28"><a href="#cb2-28" tabindex="-1"></a><span class="at">            </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Install dependencies</span></span>
<span id="cb2-29"><a href="#cb2-29" tabindex="-1"></a><span class="fu">              run</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb2-30"><a href="#cb2-30" tabindex="-1"></a>                python -m pip install --upgrade pip</span>
<span id="cb2-31"><a href="#cb2-31" tabindex="-1"></a>                pip install -r requirements.txt</span>
<span id="cb2-32"><a href="#cb2-32" tabindex="-1"></a>                    </span>
<span id="cb2-33"><a href="#cb2-33" tabindex="-1"></a><span class="co">            # This step runs the tests using the pytest command. Remember to use the --mpl and --regtest flags to run the tests that use matplotlib and pytest-regtest.</span></span>
<span id="cb2-34"><a href="#cb2-34" tabindex="-1"></a><span class="at">            </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Run tests</span></span>
<span id="cb2-35"><a href="#cb2-35" tabindex="-1"></a><span class="fu">              run</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb2-36"><a href="#cb2-36" tabindex="-1"></a>                pytest --mpl --regtest</span></code></pre>
</div>
<p>This is a simple GitHub Action that runs the tests for your code
whenever a pull request is made to the main branch.</p>
</section><section><h2 class="section-heading" id="upload-the-workflow-to-github">Upload the workflow to GitHub<a class="anchor" aria-label="anchor" href="#upload-the-workflow-to-github"></a>
<a class="anchor" aria-label="anchor" href="#upload-the-workflow-to-github"></a>
</h2>
<hr class="half-width">
<p>Now that you have created the <code>tests.yaml</code> file, you need
to upload it to GitHub.</p>
<ul>
<li>Commit the changes using <code>git add .</code> and
<code>git commit -m "Add GitHub Action to run tests"</code>
</li>
<li>Push the changes to GitHub using
<code>git push origin main</code>
</li>
</ul></section><section><h2 class="section-heading" id="enable-running-the-tests-on-a-pull-request">Enable running the tests on a Pull Request<a class="anchor" aria-label="anchor" href="#enable-running-the-tests-on-a-pull-request"></a>
<a class="anchor" aria-label="anchor" href="#enable-running-the-tests-on-a-pull-request"></a>
</h2>
<hr class="half-width">
<p>The typical use-case for a CI system is to run the tests whenever a
pull request is made to the main branch to add a feature.</p>
<ul>
<li>Go to your GitHub repository</li>
</ul>
<!-- figure
![branch protection visual instruction](episodes/fig/github-branch-protection.png) --><ul>
<li>Click on the “Settings” tab</li>
<li>Scroll down to “Branches”</li>
<li>Under “Branch protection rules” / “Branch name pattern” type
“main”</li>
<li>Select the checkbox for “Require status checks to pass before
merging”</li>
<li>Select the checkbox for “Require branches to be up to date before
merging”</li>
</ul>
<p>This makes it so when a Pull Request is made, trying to merge code
into main, it will need to have all of its tests passing before the code
can be merged.</p>
<p>Let’s test it out.</p>
<ul>
<li>Create a new branch in your repository called <code>subtract</code>
using <code>git checkout -b subtract</code>
</li>
<li>Add a new function in your <code>calculator.py</code> file that
subtracts two numbers, but make it wrong on purpose:</li>
</ul>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="kw">def</span> subtract(a, b):</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>    <span class="cf">return</span> a <span class="op">+</span> b</span></code></pre>
</div>
<ul>
<li>Then add a test for this function in your
<code>test_calculator.py</code> file:</li>
</ul>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="kw">def</span> test_subtract():</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>    <span class="cf">assert</span> subtract(<span class="dv">5</span>, <span class="dv">3</span>) <span class="op">==</span> <span class="dv">2</span></span></code></pre>
</div>
<ul>
<li><p>Commit the changes using <code>git add .</code> and
<code>git commit -m "Add subtract function"</code></p></li>
<li><p>Push the changes to GitHub using
<code>git push origin subtract</code></p></li>
<li><p>Now go to your GitHub repository and create a new Pull Request to
merge the <code>subtract</code> branch into <code>main</code></p></li>
</ul>
<p>You should see that the GitHub Action runs the tests and fails
because the test for the <code>subtract</code> function is failing.</p>
<ul>
<li>Let’s now fix the test and commit the changes:
<code>git add .</code> and
<code>git commit -m "Fix subtract function"</code>
</li>
<li>Push the changes to GitHub using
<code>git push origin subtract</code> again</li>
<li>Go back to the Pull Request on GitHub and you should see that the
tests are now passing and you can merge the code into the main
branch.</li>
</ul>
<p>So now, when you or your team want to make a feature or just update
the code, the workflow is as follows:</p>
<ul>
<li>Create a new branch for the feature</li>
<li>Write the code for the feature</li>
<li>Write tests for the feature</li>
<li>Push the code to GitHub</li>
<li>Create a Pull Request</li>
<li>Wait for the tests to pass or fail</li>
<li>If the tests pass, merge the code into the main branch or fix the
code if the tests fail</li>
</ul>
<p>This will greatly improve the quality of your code and make it easier
to collaborate with others.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Continuous Integration (CI) is the practice of automating the
merging of code changes into a project.</li>
<li>GitHub Actions is a feature of GitHub that allows you to automate
the testing of your code.</li>
<li>GitHub Actions are defined in <code>yaml</code> files and are stored
in the <code>.github/workflows</code> directory in your repository.</li>
<li>You can use GitHub Actions to only allow code to be merged into the
main branch if the tests pass.</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section>
</div>
    </main>
</div>
<!-- END  : inst/pkgdown/templates/content-extra.html -->

      </div>
<!--/div.row-->
      		<footer class="row footer mx-md-3"><hr>
<div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>

        <a href="https://github.com/SylviaWhittle/python-testing-for-research/edit/main/README.md" class="external-link">Edit on GitHub</a>

	
        | <a href="https://github.com/SylviaWhittle/python-testing-for-research/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/SylviaWhittle/python-testing-for-research/" class="external-link">Source</a></p>
				<p><a href="https://github.com/SylviaWhittle/python-testing-for-research/blob/main/CITATION" class="external-link">Cite</a> | <a href="mailto:sylvia.whittle@sheffield.ac.uk">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">

        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>

        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.16.5" class="external-link">sandpaper (0.16.5)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.6" class="external-link">pegboard (0.7.6)</a>, and <a href="https://github.com/carpentries/varnish/tree/1.0.3" class="external-link">varnish (1.0.3)</a></p>
			</div>
		</footer>
</div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://SylviaWhittle.github.io/python-testing-for-research/aio.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, data, lesson, The Carpentries, Testing, FAIR4RS, Python, CI, Continuous Integration, Tests",
  "name": "All in One View",
  "creativeWorkStatus": "active",
  "url": "https://SylviaWhittle.github.io/python-testing-for-research/aio.html",
  "identifier": "https://SylviaWhittle.github.io/python-testing-for-research/aio.html",
  "dateCreated": "2024-03-08",
  "dateModified": "2024-07-09",
  "datePublished": "2024-07-09"
}

  </script><script>
		feather.replace();
	</script>
</body>
</html><!-- END:   inst/pkgdown/templates/layout.html-->

